<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Examples &#8212; PythTB 1.8.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css?v=2bf1fcf8" />
    <link rel="stylesheet" type="text/css" href="_static/plot_directive.css?v=7f9a90b1" />
    
    <script src="_static/documentation_options.js?v=371fd5e7"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Formalism" href="formalism.html" />
    <link rel="prev" title="Installation" href="install.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="formalism.html" title="Formalism"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="install.html" title="Installation"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">PythTB 1.8.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Examples</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="examples">
<h1>Examples<a class="headerlink" href="#examples" title="Link to this heading">¶</a></h1>
<p>If you are unfamiliar with Python or are not sure whether Python and
the needed Python modules are installed on your system, see our
<a class="reference internal" href="resources.html"><span class="doc">python introduction</span></a> and <a class="reference internal" href="install.html"><span class="doc">installation
instructions</span></a>.</p>
<p>You can download each example script below indvidually by clicking on
the ‘Source code’ link under each example.  Alternatively, you can
download all example files as a single tar file</p>
<blockquote>
<div><p><a class="reference download internal" download="" href="_downloads/56b70a8999debf50199827c16e4fecd8/pythtb-examples.tar.gz"><code class="xref download docutils literal notranslate"><span class="pre">pythtb-examples.tar.gz</span></code></a></p>
</div></blockquote>
<p>to untar this file use the following unix command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tar</span> <span class="o">-</span><span class="n">zxf</span> <span class="n">pythtb</span><span class="o">-</span><span class="n">examples</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
</pre></div>
</div>
<p id="simple-example">Note that there is also a useful <a class="reference external" href="https://minisites.cambridgecore.org/berryphases/ptb_samples.html">collection of PythTB sample programs</a> that
were developed in connection with David Vanderbilt’s book <a class="reference external" href="https:/www.cambridge.org/9781107157651">Berry Phases in
Electronic Structure Theory</a>
(Cambridge University Press, 2018).</p>
<section id="id1">
<h2>Simple example<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h2>
<p>After installing PythTB you can run the following <a class="reference download internal" download="" href="_downloads/47e1850470f278ea40c97697e1ef6433/simple.py"><code class="xref download docutils literal notranslate"><span class="pre">simple</span> <span class="pre">example</span></code></a> either as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">simple</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>or by making script executable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chmod</span> <span class="n">u</span><span class="o">+</span><span class="n">x</span> <span class="n">simple</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>and then executing it with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">simple</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>After you have executed the script, in that same folder file band.pdf
should appear and it should look similar to the figure below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1"># one dimensional chain</span>

<span class="c1"># Copyright under GNU General Public License 2010, 2012, 2016</span>
<span class="c1"># by Sinisa Coh and David Vanderbilt (see gpl-pythtb.txt)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pythtb</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span> <span class="c1"># import TB model class</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># specify model</span>
<span class="n">lat</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.0</span><span class="p">]]</span>
<span class="n">orb</span><span class="o">=</span><span class="p">[[</span><span class="mf">0.0</span><span class="p">]]</span>
<span class="n">my_model</span><span class="o">=</span><span class="n">tb_model</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">orb</span><span class="p">)</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># define a path in k-space</span>
<span class="p">(</span><span class="n">k_vec</span><span class="p">,</span><span class="n">k_dist</span><span class="p">,</span><span class="n">k_node</span><span class="p">)</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">k_path</span><span class="p">(</span><span class="s1">&#39;full&#39;</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">k_label</span><span class="o">=</span><span class="p">[</span><span class="sa">r</span><span class="s2">&quot;$0$&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;$\pi$&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$2\pi$&quot;</span><span class="p">]</span>

<span class="c1"># solve model</span>
<span class="n">evals</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">solve_all</span><span class="p">(</span><span class="n">k_vec</span><span class="p">)</span>

<span class="c1"># plot band structure</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_dist</span><span class="p">,</span><span class="n">evals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;1D chain band structure&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Path in k-space&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Band energy&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">k_node</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">k_label</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">k_node</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">k_node</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k_node</span><span class="p">)):</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">k_node</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;simple_band.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/3bffe8246ccd714e29d59d87a2ab0582/simple.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/4510c8065ba864427c5885c3489b5e4a/simple.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/a88aa0fa625e421c44acb008b8a5e2fd/simple.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/simple.png" class="plot-directive" src="_images/simple.png" />
</figure>
</section>
<section id="checkerboard-model">
<span id="checkerboard-example"></span><h2>Checkerboard model<a class="headerlink" href="#checkerboard-model" title="Link to this heading">¶</a></h2>
<p>Simple two-dimensional model.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1"># two dimensional tight-binding checkerboard model</span>

<span class="c1"># Copyright under GNU General Public License 2010, 2012, 2016</span>
<span class="c1"># by Sinisa Coh and David Vanderbilt (see gpl-pythtb.txt)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pythtb</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span> <span class="c1"># import TB model class</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># define lattice vectors</span>
<span class="n">lat</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]]</span>
<span class="c1"># define coordinates of orbitals</span>
<span class="n">orb</span><span class="o">=</span><span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">]]</span>

<span class="c1"># make two dimensional tight-binding checkerboard model</span>
<span class="n">my_model</span><span class="o">=</span><span class="n">tb_model</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">orb</span><span class="p">)</span>

<span class="c1"># set model parameters</span>
<span class="n">delta</span><span class="o">=</span><span class="mf">1.1</span>
<span class="n">t</span><span class="o">=</span><span class="mf">0.6</span>

<span class="c1"># set on-site energies</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_onsite</span><span class="p">([</span><span class="o">-</span><span class="n">delta</span><span class="p">,</span><span class="n">delta</span><span class="p">])</span>
<span class="c1"># set hoppings (one for each connected pair of orbitals)</span>
<span class="c1"># (amplitude, i, j, [lattice vector to cell containing j])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="c1"># print tight-binding model</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>

<span class="c1"># generate k-point path and labels</span>
<span class="n">path</span><span class="o">=</span><span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">],[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">],[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]]</span>
<span class="n">label</span><span class="o">=</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Gamma $&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$X$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$M$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\Gamma $&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="n">k_vec</span><span class="p">,</span><span class="n">k_dist</span><span class="p">,</span><span class="n">k_node</span><span class="p">)</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">k_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="mi">301</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------------------------------&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;starting calculation&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------------------------------&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Calculating bands...&#39;</span><span class="p">)</span>

<span class="c1"># solve for eigenenergies of hamiltonian on</span>
<span class="c1"># the set of k-points from above</span>
<span class="n">evals</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">solve_all</span><span class="p">(</span><span class="n">k_vec</span><span class="p">)</span>

<span class="c1"># plotting of band structure</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plotting bandstructure...&#39;</span><span class="p">)</span>

<span class="c1"># First make a figure object</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="c1"># specify horizontal axis details</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">k_node</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">k_node</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">k_node</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k_node</span><span class="p">)):</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">k_node</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="c1"># plot bands</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_dist</span><span class="p">,</span><span class="n">evals</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
<span class="c1"># put title</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Checkerboard band structure&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Path in k-space&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Band energy&quot;</span><span class="p">)</span>
<span class="c1"># make an PDF figure of a plot</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;checkerboard_band.pdf&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/d6423a61f14cb299b1372335d4649a09/checkerboard.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/cd5415a071dc030294ce5f8699d98d4e/checkerboard.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/deaac0713535788fa721c6b3aeec458f/checkerboard.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/checkerboard.png" class="plot-directive" src="_images/checkerboard.png" />
</figure>
</section>
<section id="trestle">
<span id="trestle-example"></span><h2>Trestle<a class="headerlink" href="#trestle" title="Link to this heading">¶</a></h2>
<p>Simple model with one-dimensional k-space, two-dimensional r-space,
and with complex hoppings.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1"># one dimensional tight-binding model of a trestle-like structure</span>

<span class="c1"># Copyright under GNU General Public License 2010, 2012, 2016</span>
<span class="c1"># by Sinisa Coh and David Vanderbilt (see gpl-pythtb.txt)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pythtb</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span> <span class="c1"># import TB model class</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># define lattice vectors</span>
<span class="n">lat</span><span class="o">=</span><span class="p">[[</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]]</span>
<span class="c1"># define coordinates of orbitals</span>
<span class="n">orb</span><span class="o">=</span><span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]]</span>

<span class="c1"># make one dimensional tight-binding model of a trestle-like structure</span>
<span class="n">my_model</span><span class="o">=</span><span class="n">tb_model</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">orb</span><span class="p">,</span><span class="n">per</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># set model parameters</span>
<span class="n">t_first</span><span class="o">=</span><span class="mf">0.8</span><span class="o">+</span><span class="mf">0.6</span><span class="n">j</span>
<span class="n">t_second</span><span class="o">=</span><span class="mf">2.0</span>

<span class="c1"># leave on-site energies to default zero values</span>
<span class="c1"># set hoppings (one for each connected pair of orbitals)</span>
<span class="c1"># (amplitude, i, j, [lattice vector to cell containing j])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t_second</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t_second</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t_first</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t_first</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># print tight-binding model</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>

<span class="c1"># generate list of k-points following some high-symmetry line in</span>
<span class="p">(</span><span class="n">k_vec</span><span class="p">,</span><span class="n">k_dist</span><span class="p">,</span><span class="n">k_node</span><span class="p">)</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">k_path</span><span class="p">(</span><span class="s1">&#39;fullc&#39;</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">k_label</span><span class="o">=</span><span class="p">[</span><span class="sa">r</span><span class="s2">&quot;$-\pi$&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;$0$&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\pi$&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------------------------------&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;starting calculation&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------------------------------&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Calculating bands...&#39;</span><span class="p">)</span>

<span class="c1"># solve for eigenenergies of hamiltonian on</span>
<span class="c1"># the set of k-points from above</span>
<span class="n">evals</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">solve_all</span><span class="p">(</span><span class="n">k_vec</span><span class="p">)</span>

<span class="c1"># plotting of band structure</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plotting bandstructure...&#39;</span><span class="p">)</span>

<span class="c1"># First make a figure object</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="c1"># specify horizontal axis details</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">k_node</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">k_node</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">k_node</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">k_label</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">k_node</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="c1"># plot first band</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_dist</span><span class="p">,</span><span class="n">evals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c1"># plot second band</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_dist</span><span class="p">,</span><span class="n">evals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="c1"># put title</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Trestle band structure&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Path in k-space&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Band energy&quot;</span><span class="p">)</span>
<span class="c1"># make an PDF figure of a plot</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;trestle_band.pdf&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/b5ca789ee9c782e377ccb41a9febaaaa/trestle.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/4b47e861cb27aa2ae894b54987e1ff49/trestle.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/6cf390968a0508798f0b94587c9c91bd/trestle.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/trestle.png" class="plot-directive" src="_images/trestle.png" />
</figure>
</section>
<section id="molecule">
<span id="dim-example"></span><h2>Molecule<a class="headerlink" href="#molecule" title="Link to this heading">¶</a></h2>
<p>This is a zero-dimensional example of a molecule.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1"># zero dimensional tight-binding model of a NH3 molecule</span>

<span class="c1"># Copyright under GNU General Public License 2010, 2012, 2016</span>
<span class="c1"># by Sinisa Coh and David Vanderbilt (see gpl-pythtb.txt)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pythtb</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span> <span class="c1"># import TB model class</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># define lattice vectors</span>
<span class="n">lat</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]]</span>
<span class="c1"># define coordinates of orbitals</span>
<span class="n">sq32</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
<span class="n">orb</span><span class="o">=</span><span class="p">[[</span> <span class="p">(</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span><span class="o">*</span><span class="n">sq32</span><span class="p">,</span> <span class="mf">0.</span>   <span class="p">,</span><span class="mf">0.</span><span class="p">],</span>
     <span class="p">[(</span><span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span><span class="o">*</span><span class="n">sq32</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="mf">0.</span><span class="p">],</span>
     <span class="p">[(</span><span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span><span class="o">*</span><span class="n">sq32</span><span class="p">,</span><span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="mf">0.</span><span class="p">],</span>
     <span class="p">[</span>  <span class="mf">0.</span>         <span class="p">,</span> <span class="mf">0.</span>   <span class="p">,</span><span class="mf">1.</span><span class="p">]]</span>
<span class="c1"># make zero dimensional tight-binding model</span>
<span class="n">my_model</span><span class="o">=</span><span class="n">tb_model</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">orb</span><span class="p">)</span>

<span class="c1"># set model parameters</span>
<span class="n">delta</span><span class="o">=</span><span class="mf">0.5</span>
<span class="n">t_first</span><span class="o">=</span><span class="mf">1.0</span>

<span class="c1"># change on-site energies so that N and H don&#39;t have the same energy</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_onsite</span><span class="p">([</span><span class="o">-</span><span class="n">delta</span><span class="p">,</span><span class="o">-</span><span class="n">delta</span><span class="p">,</span><span class="o">-</span><span class="n">delta</span><span class="p">,</span><span class="n">delta</span><span class="p">])</span>
<span class="c1"># set hoppings (one for each connected pair of orbitals)</span>
<span class="c1"># (amplitude, i, j)</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t_first</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t_first</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t_first</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t_first</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t_first</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t_first</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="c1"># print tight-binding model</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------------------------------&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;starting calculation&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------------------------------&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Calculating bands...&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Band energies&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>    
<span class="c1"># solve for eigenenergies of hamiltonian</span>
<span class="n">evals</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">solve_all</span><span class="p">()</span>

<span class="c1"># First make a figure object</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="c1"># plot all states</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">evals</span><span class="p">,</span><span class="s2">&quot;bo&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">3.3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">evals</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="n">evals</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span>
<span class="c1"># put title</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Molecule levels&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Orbital&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Energy&quot;</span><span class="p">)</span>
<span class="c1"># make an PDF figure of a plot</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;0dim_spectrum.pdf&quot;</span><span class="p">)</span>                    

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/7be3f615e4919a10c6ea8b49414c44b1/0dim.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/955389026b0c7ec031cbc62b62da56d6/0dim.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/21432fa79550118a452a2d7480d4cbf0/0dim.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/0dim.png" class="plot-directive" src="_images/0dim.png" />
</figure>
</section>
<section id="graphene-model">
<span id="graphene-example"></span><h2>Graphene model<a class="headerlink" href="#graphene-model" title="Link to this heading">¶</a></h2>
<p>This is a toy model of a two-dimensional graphene sheet.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1"># Toy graphene model</span>

<span class="c1"># Copyright under GNU General Public License 2010, 2012, 2016</span>
<span class="c1"># by Sinisa Coh and David Vanderbilt (see gpl-pythtb.txt)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pythtb</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span> <span class="c1"># import TB model class</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># define lattice vectors</span>
<span class="n">lat</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.5</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">]]</span>
<span class="c1"># define coordinates of orbitals</span>
<span class="n">orb</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">],[</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">]]</span>

<span class="c1"># make two dimensional tight-binding graphene model</span>
<span class="n">my_model</span><span class="o">=</span><span class="n">tb_model</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">orb</span><span class="p">)</span>

<span class="c1"># set model parameters</span>
<span class="n">delta</span><span class="o">=</span><span class="mf">0.0</span>
<span class="n">t</span><span class="o">=-</span><span class="mf">1.0</span>

<span class="c1"># set on-site energies</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_onsite</span><span class="p">([</span><span class="o">-</span><span class="n">delta</span><span class="p">,</span><span class="n">delta</span><span class="p">])</span>
<span class="c1"># set hoppings (one for each connected pair of orbitals)</span>
<span class="c1"># (amplitude, i, j, [lattice vector to cell containing j])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="c1"># print tight-binding model</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>

<span class="c1"># generate list of k-points following a segmented path in the BZ</span>
<span class="c1"># list of nodes (high-symmetry points) that will be connected</span>
<span class="n">path</span><span class="o">=</span><span class="p">[[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">],[</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">],[</span><span class="mf">.5</span><span class="p">,</span><span class="mf">.5</span><span class="p">],[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">]]</span>
<span class="c1"># labels of the nodes</span>
<span class="n">label</span><span class="o">=</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Gamma $&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$K$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$M$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\Gamma $&#39;</span><span class="p">)</span>
<span class="c1"># total number of interpolated k-points along the path</span>
<span class="n">nk</span><span class="o">=</span><span class="mi">121</span>

<span class="c1"># call function k_path to construct the actual path</span>
<span class="p">(</span><span class="n">k_vec</span><span class="p">,</span><span class="n">k_dist</span><span class="p">,</span><span class="n">k_node</span><span class="p">)</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">k_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">nk</span><span class="p">)</span>
<span class="c1"># inputs:</span>
<span class="c1">#   path, nk: see above</span>
<span class="c1">#   my_model: the pythtb model</span>
<span class="c1"># outputs:</span>
<span class="c1">#   k_vec: list of interpolated k-points</span>
<span class="c1">#   k_dist: horizontal axis position of each k-point in the list</span>
<span class="c1">#   k_node: horizontal axis position of each original node</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------------------------------&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;starting calculation&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------------------------------&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Calculating bands...&#39;</span><span class="p">)</span>

<span class="c1"># obtain eigenvalues to be plotted</span>
<span class="n">evals</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">solve_all</span><span class="p">(</span><span class="n">k_vec</span><span class="p">)</span>

<span class="c1"># figure for bandstructure</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="c1"># specify horizontal axis details</span>
<span class="c1"># set range of horizontal axis</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">k_node</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">k_node</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="c1"># put tickmarks and labels at node positions</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">k_node</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
<span class="c1"># add vertical lines at node positions</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k_node</span><span class="p">)):</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">k_node</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="c1"># put title</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Graphene band structure&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Path in k-space&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Band energy&quot;</span><span class="p">)</span>

<span class="c1"># plot first and second band</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_dist</span><span class="p">,</span><span class="n">evals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_dist</span><span class="p">,</span><span class="n">evals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># make an PDF figure of a plot</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;graphene.pdf&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/26ae0eb0e3920196f67d79d8d1d69753/graphene.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/6261ec5a9351a4ce507860d9376dcefc/graphene.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/ba4fc697b6169694464f30c943dc9d5c/graphene.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/graphene.png" class="plot-directive" src="_images/graphene.png" />
</figure>
</section>
<section id="berry-phase-around-dirac-cone-in-graphene">
<span id="cone-example"></span><h2>Berry phase around Dirac cone in graphene<a class="headerlink" href="#berry-phase-around-dirac-cone-in-graphene" title="Link to this heading">¶</a></h2>
<p>This example computes Berry phases for a circular path (in reduced
coordinates) around the Dirac point of the graphene band structure. In
order to have a well defined sign of the Berry phase, a small on-site
staggered potential is added in order to open a gap at the Dirac point.</p>
<p>After computing the Berry phase around the circular loop, it also computes
the integral of the Berry curvature over a small square patch in the
Brillouin zone containing the Dirac point, and plots individual phases
for each plaquette in the array.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1"># Compute Berry phase around Dirac cone in</span>
<span class="c1"># graphene with staggered onsite term delta</span>

<span class="c1"># Copyright under GNU General Public License 2010, 2012, 2016</span>
<span class="c1"># by Sinisa Coh and David Vanderbilt (see gpl-pythtb.txt)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pythtb</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span> <span class="c1"># import TB model class</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># define lattice vectors</span>
<span class="n">lat</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.5</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">]]</span>
<span class="c1"># define coordinates of orbitals</span>
<span class="n">orb</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">],[</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">]]</span>

<span class="c1"># make two dimensional tight-binding graphene model</span>
<span class="n">my_model</span><span class="o">=</span><span class="n">tb_model</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">orb</span><span class="p">)</span>

<span class="c1"># set model parameters</span>
<span class="n">delta</span><span class="o">=-</span><span class="mf">0.1</span> <span class="c1"># small staggered onsite term</span>
<span class="n">t</span><span class="o">=-</span><span class="mf">1.0</span>

<span class="c1"># set on-site energies</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_onsite</span><span class="p">([</span><span class="o">-</span><span class="n">delta</span><span class="p">,</span><span class="n">delta</span><span class="p">])</span>
<span class="c1"># set hoppings (one for each connected pair of orbitals)</span>
<span class="c1"># (amplitude, i, j, [lattice vector to cell containing j])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="c1"># print tight-binding model</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>

<span class="c1"># construct circular path around Dirac cone</span>
<span class="c1">#   parameters of the path</span>
<span class="n">circ_step</span><span class="o">=</span><span class="mi">31</span>
<span class="n">circ_center</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">,</span><span class="mf">2.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">])</span>
<span class="n">circ_radius</span><span class="o">=</span><span class="mf">0.05</span>
<span class="c1"># one-dimensional wf_array to store wavefunctions on the path</span>
<span class="n">w_circ</span><span class="o">=</span><span class="n">wf_array</span><span class="p">(</span><span class="n">my_model</span><span class="p">,[</span><span class="n">circ_step</span><span class="p">])</span>
<span class="c1"># now populate array with wavefunctions</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">circ_step</span><span class="p">):</span>
    <span class="c1"># construct k-point coordinate on the path</span>
    <span class="n">ang</span><span class="o">=</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">circ_step</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">kpt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ang</span><span class="p">)</span><span class="o">*</span><span class="n">circ_radius</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">)</span><span class="o">*</span><span class="n">circ_radius</span><span class="p">])</span>
    <span class="n">kpt</span><span class="o">+=</span><span class="n">circ_center</span>
    <span class="c1"># find and store eigenvectors for this k-point</span>
    <span class="n">w_circ</span><span class="o">.</span><span class="n">solve_on_one_point</span><span class="p">(</span><span class="n">kpt</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
<span class="c1"># make sure that first and last points are the same</span>
<span class="n">w_circ</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">w_circ</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># compute Berry phase along circular path</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Berry phase along circle with radius: &quot;</span><span class="p">,</span><span class="n">circ_radius</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  centered at k-point: &quot;</span><span class="p">,</span><span class="n">circ_center</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  for band 0 equals    : &quot;</span><span class="p">,</span> <span class="n">w_circ</span><span class="o">.</span><span class="n">berry_phase</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span><span class="mi">0</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  for band 1 equals    : &quot;</span><span class="p">,</span> <span class="n">w_circ</span><span class="o">.</span><span class="n">berry_phase</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  for both bands equals: &quot;</span><span class="p">,</span> <span class="n">w_circ</span><span class="o">.</span><span class="n">berry_phase</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>

<span class="c1"># construct two-dimensional square patch covering the Dirac cone</span>
<span class="c1">#  parameters of the patch</span>
<span class="n">square_step</span><span class="o">=</span><span class="mi">31</span>
<span class="n">square_center</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">,</span><span class="mf">2.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">])</span>
<span class="n">square_length</span><span class="o">=</span><span class="mf">0.1</span>
<span class="c1"># two-dimensional wf_array to store wavefunctions on the path</span>
<span class="n">w_square</span><span class="o">=</span><span class="n">wf_array</span><span class="p">(</span><span class="n">my_model</span><span class="p">,[</span><span class="n">square_step</span><span class="p">,</span><span class="n">square_step</span><span class="p">])</span>
<span class="n">all_kpt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">square_step</span><span class="p">,</span><span class="n">square_step</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="c1"># now populate array with wavefunctions</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">square_step</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">square_step</span><span class="p">):</span>
        <span class="c1"># construct k-point on the square patch</span>
        <span class="n">kpt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">square_length</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">square_step</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span>
                      <span class="n">square_length</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">square_step</span><span class="o">-</span><span class="mi">1</span><span class="p">))])</span>        
        <span class="n">kpt</span><span class="o">+=</span><span class="n">square_center</span>
        <span class="c1"># store k-points for plotting</span>
        <span class="n">all_kpt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,:]</span><span class="o">=</span><span class="n">kpt</span>
        <span class="c1"># find eigenvectors at this k-point</span>
        <span class="p">(</span><span class="nb">eval</span><span class="p">,</span><span class="n">evec</span><span class="p">)</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">solve_one</span><span class="p">(</span><span class="n">kpt</span><span class="p">,</span><span class="n">eig_vectors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># store eigenvector into wf_array object</span>
        <span class="n">w_square</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">evec</span>

<span class="c1"># compute Berry flux on this square patch</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Berry flux on square patch with length: &quot;</span><span class="p">,</span><span class="n">square_length</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  centered at k-point: &quot;</span><span class="p">,</span><span class="n">square_center</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  for band 0 equals    : &quot;</span><span class="p">,</span> <span class="n">w_square</span><span class="o">.</span><span class="n">berry_flux</span><span class="p">([</span><span class="mi">0</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  for band 1 equals    : &quot;</span><span class="p">,</span> <span class="n">w_square</span><span class="o">.</span><span class="n">berry_flux</span><span class="p">([</span><span class="mi">1</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  for both bands equals: &quot;</span><span class="p">,</span> <span class="n">w_square</span><span class="o">.</span><span class="n">berry_flux</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">()</span>

<span class="c1"># also plot Berry phase on each small plaquette of the mesh</span>
<span class="n">plaq</span><span class="o">=</span><span class="n">w_square</span><span class="o">.</span><span class="n">berry_flux</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span><span class="n">individual_phases</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">plaq</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span>
          <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="n">all_kpt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">all_kpt</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                  <span class="n">all_kpt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">all_kpt</span><span class="p">[</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Berry curvature near Dirac cone&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$k_x$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$k_y$&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;cone_phases.pdf&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/4306ea35168dce8098f70d6be28a7a60/cone.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/bf562c4e5919263ea6b08022601721e0/cone.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/e3784164fe6f8530e31ea30b9b072531/cone.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/cone.png" class="plot-directive" src="_images/cone.png" />
</figure>
</section>
<section id="one-dimensional-cycle-of-1d-tight-binding-model">
<span id="site-cycle-example"></span><h2>One-dimensional cycle of 1D tight-binding model<a class="headerlink" href="#one-dimensional-cycle-of-1d-tight-binding-model" title="Link to this heading">¶</a></h2>
<p>This example considers a simple three-site one-dimensional tight-binding
model parametrized by some parameter <img class="math" src="_images/math/cefc603e5658facb747581f9567192993f21c7ab.png" alt="\lambda"/>. As <img class="math" src="_images/math/cefc603e5658facb747581f9567192993f21c7ab.png" alt="\lambda"/>
is changed from 0 to 1, the deepest onsite term is moved from the first
to second, then to the third, and then back to the first tight-binding
orbital. Therefore, we expect that Wannier center of the lowest band will
shift by one lattice vector as <img class="math" src="_images/math/cefc603e5658facb747581f9567192993f21c7ab.png" alt="\lambda"/> changes from 0 to 1.</p>
<p>Also plots the individual on-site energies, band structure, and Wannier
center of lowest band.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1"># one-dimensional family of tight binding models</span>
<span class="c1"># parametrized by one parameter, lambda</span>

<span class="c1"># Copyright under GNU General Public License 2010, 2012, 2016</span>
<span class="c1"># by Sinisa Coh and David Vanderbilt (see gpl-pythtb.txt)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pythtb</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span> <span class="c1"># import TB model class</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># define lattice vectors</span>
<span class="n">lat</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.0</span><span class="p">]]</span>
<span class="c1"># define coordinates of orbitals</span>
<span class="n">orb</span><span class="o">=</span><span class="p">[[</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">],[</span><span class="mf">2.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">]]</span>

<span class="c1"># make one dimensional tight-binding model</span>
<span class="n">my_model</span><span class="o">=</span><span class="n">tb_model</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">orb</span><span class="p">)</span>

<span class="c1"># set model parameters</span>
<span class="n">delta</span><span class="o">=</span><span class="mf">2.0</span>
<span class="n">t</span><span class="o">=-</span><span class="mf">1.0</span>

<span class="c1"># set hoppings (one for each connected pair of orbitals)</span>
<span class="c1"># (amplitude, i, j, [lattice vector to cell containing j])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># plot onsite terms for each site</span>
<span class="n">fig_onsite</span><span class="p">,</span> <span class="n">ax_onsite</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="c1"># plot band structure for each lambda</span>
<span class="n">fig_band</span><span class="p">,</span>   <span class="n">ax_band</span>   <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="c1"># evolve tight-binding parameter along some path by</span>
<span class="c1"># performing a change of onsite terms</span>
<span class="c1">#   how many steps to take along the path (including end points)</span>
<span class="n">path_steps</span><span class="o">=</span><span class="mi">21</span>
<span class="c1">#   create lambda mesh from 0.0 to 1.0 (21 values and 20 intervals)</span>
<span class="n">all_lambda</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="n">path_steps</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">#   how many k-points to use (31 values and 30 intervals)</span>
<span class="n">num_kpt</span><span class="o">=</span><span class="mi">31</span>
<span class="c1"># two-dimensional wf_array in which we will store wavefunctions</span>
<span class="c1"># for all k-points and all values of lambda.  (note that the index</span>
<span class="c1"># order [k,lambda] is important for interpreting the sign.)</span>
<span class="n">wf_kpt_lambda</span><span class="o">=</span><span class="n">wf_array</span><span class="p">(</span><span class="n">my_model</span><span class="p">,[</span><span class="n">num_kpt</span><span class="p">,</span><span class="n">path_steps</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i_lambda</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">path_steps</span><span class="p">):</span>
    <span class="c1"># for each step along the path compute onsite terms for each orbital</span>
    <span class="n">lmbd</span><span class="o">=</span><span class="n">all_lambda</span><span class="p">[</span><span class="n">i_lambda</span><span class="p">]</span>
    <span class="n">onsite_0</span><span class="o">=</span><span class="n">delta</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">lmbd</span><span class="o">-</span><span class="mf">0.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">))</span>
    <span class="n">onsite_1</span><span class="o">=</span><span class="n">delta</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">lmbd</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">))</span>
    <span class="n">onsite_2</span><span class="o">=</span><span class="n">delta</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">lmbd</span><span class="o">-</span><span class="mf">2.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">))</span>

    <span class="c1"># update onsite terms by rewriting previous values</span>
    <span class="n">my_model</span><span class="o">.</span><span class="n">set_onsite</span><span class="p">([</span><span class="n">onsite_0</span><span class="p">,</span><span class="n">onsite_1</span><span class="p">,</span><span class="n">onsite_2</span><span class="p">],</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;reset&quot;</span><span class="p">)</span>

    <span class="c1"># create k mesh over 1D Brillouin zone</span>
    <span class="p">(</span><span class="n">k_vec</span><span class="p">,</span><span class="n">k_dist</span><span class="p">,</span><span class="n">k_node</span><span class="p">)</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">k_path</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">],[</span><span class="mf">0.5</span><span class="p">]],</span><span class="n">num_kpt</span><span class="p">,</span><span class="n">report</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># solve model on all of these k-points</span>
    <span class="p">(</span><span class="nb">eval</span><span class="p">,</span><span class="n">evec</span><span class="p">)</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">solve_all</span><span class="p">(</span><span class="n">k_vec</span><span class="p">,</span><span class="n">eig_vectors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># store wavefunctions (eigenvectors)</span>
    <span class="k">for</span> <span class="n">i_kpt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_kpt</span><span class="p">):</span>
        <span class="n">wf_kpt_lambda</span><span class="p">[</span><span class="n">i_kpt</span><span class="p">,</span><span class="n">i_lambda</span><span class="p">]</span><span class="o">=</span><span class="n">evec</span><span class="p">[:,</span><span class="n">i_kpt</span><span class="p">,:]</span>

    <span class="c1"># plot on-site terms</span>
    <span class="n">ax_onsite</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">lmbd</span><span class="p">],[</span><span class="n">onsite_0</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
    <span class="n">ax_onsite</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">lmbd</span><span class="p">],[</span><span class="n">onsite_1</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s2">&quot;g&quot;</span><span class="p">)</span>
    <span class="n">ax_onsite</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">lmbd</span><span class="p">],[</span><span class="n">onsite_2</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>
    <span class="c1"># plot band structure for all three bands</span>
    <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">eval</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">ax_band</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_dist</span><span class="p">,</span><span class="nb">eval</span><span class="p">[</span><span class="n">band</span><span class="p">,:],</span><span class="s2">&quot;k-&quot;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># impose periodic boundary condition along k-space direction only</span>
<span class="c1"># (so that |psi_nk&gt; at k=0 and k=1 have the same phase)</span>
<span class="n">wf_kpt_lambda</span><span class="o">.</span><span class="n">impose_pbc</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># compute Berry phase along k-direction for each lambda</span>
<span class="n">phase</span><span class="o">=</span><span class="n">wf_kpt_lambda</span><span class="o">.</span><span class="n">berry_phase</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># plot position of Wannier function for bottom band</span>
<span class="n">fig_wann</span><span class="p">,</span> <span class="n">ax_wann</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="c1"># wannier center in reduced coordinates</span>
<span class="n">wann_center</span><span class="o">=</span><span class="n">phase</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="c1"># plot wannier centers</span>
<span class="n">ax_wann</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">all_lambda</span><span class="p">,</span><span class="n">wann_center</span><span class="p">,</span><span class="s2">&quot;ko-&quot;</span><span class="p">)</span>

<span class="c1"># compute integrated curvature</span>
<span class="n">final</span><span class="o">=</span><span class="n">wf_kpt_lambda</span><span class="o">.</span><span class="n">berry_flux</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Berry flux in k-lambda space: &quot;</span><span class="p">,</span><span class="n">final</span><span class="p">)</span>

<span class="c1"># finish plot of onsite terms</span>
<span class="n">ax_onsite</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Onsite energy for all three orbitals&quot;</span><span class="p">)</span>
<span class="n">ax_onsite</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Lambda parameter&quot;</span><span class="p">)</span>
<span class="n">ax_onsite</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Onsite terms&quot;</span><span class="p">)</span>
<span class="n">ax_onsite</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">fig_onsite</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig_onsite</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;3site_onsite.pdf&quot;</span><span class="p">)</span>
<span class="c1"># finish plot for band structure</span>
<span class="n">ax_band</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Band structure&quot;</span><span class="p">)</span>
<span class="n">ax_band</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Path in k-vector&quot;</span><span class="p">)</span>
<span class="n">ax_band</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Band energies&quot;</span><span class="p">)</span>
<span class="n">ax_band</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">fig_band</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig_band</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;3site_band.pdf&quot;</span><span class="p">)</span>
<span class="c1"># finish plot for Wannier center</span>
<span class="n">ax_wann</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Center of Wannier function&quot;</span><span class="p">)</span>
<span class="n">ax_wann</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Lambda parameter&quot;</span><span class="p">)</span>
<span class="n">ax_wann</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Center (reduced coordinate)&quot;</span><span class="p">)</span>
<span class="n">ax_wann</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">fig_wann</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig_wann</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;3site_wann.pdf&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/791b87ddfdbee006d6b395cfbfbe63f8/3site_cycle.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>)</p>
<figure class="align-default" id="id4">
<img alt="_images/3site_cycle_00.png" class="plot-directive" src="_images/3site_cycle_00.png" />
<figcaption>
<p><span class="caption-text">(<a class="reference download internal" download="" href="_downloads/4e4ca464dcf1896d17dd06db311d1ae7/3site_cycle_00.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/1d34cdc3a689a7fb5715899178978702/3site_cycle_00.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</span><a class="headerlink" href="#id4" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id5">
<img alt="_images/3site_cycle_01.png" class="plot-directive" src="_images/3site_cycle_01.png" />
<figcaption>
<p><span class="caption-text">(<a class="reference download internal" download="" href="_downloads/b258062777ca7edf40b9e47e0b18bfc4/3site_cycle_01.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/d646548e33c18df1136aa67d7a78a7fc/3site_cycle_01.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</span><a class="headerlink" href="#id5" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id6">
<img alt="_images/3site_cycle_02.png" class="plot-directive" src="_images/3site_cycle_02.png" />
<figcaption>
<p><span class="caption-text">(<a class="reference download internal" download="" href="_downloads/2d78e301a2da0f0e0962ecb4f0a73e19/3site_cycle_02.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/ab02ed71649476450aff8c809201674e/3site_cycle_02.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</span><a class="headerlink" href="#id6" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="one-dimensional-cycle-on-a-finite-1d-chain">
<span id="site-cycle-fin-example"></span><h2>One-dimensional cycle on a finite 1D chain<a class="headerlink" href="#one-dimensional-cycle-on-a-finite-1d-chain" title="Link to this heading">¶</a></h2>
<p>This example is based on the same model as the one above but it
considers the effect of the one-dimensional cycle on the edge states
of a finite chain.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1"># one-dimensional family of tight binding models</span>
<span class="c1"># parametrized by one parameter, lambda</span>

<span class="c1"># Copyright under GNU General Public License 2010, 2012, 2016</span>
<span class="c1"># by Sinisa Coh and David Vanderbilt (see gpl-pythtb.txt)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pythtb</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span> <span class="c1"># import TB model class</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># define function to construct model</span>
<span class="k">def</span><span class="w"> </span><span class="nf">set_model</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">delta</span><span class="p">,</span><span class="n">lmbd</span><span class="p">):</span>
    <span class="n">lat</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.0</span><span class="p">]]</span>
    <span class="n">orb</span><span class="o">=</span><span class="p">[[</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">],[</span><span class="mf">2.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">]]</span>
    <span class="n">model</span><span class="o">=</span><span class="n">tb_model</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">orb</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">onsite_0</span><span class="o">=</span><span class="n">delta</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">lmbd</span><span class="o">-</span><span class="mf">0.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">))</span>
    <span class="n">onsite_1</span><span class="o">=</span><span class="n">delta</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">lmbd</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">))</span>
    <span class="n">onsite_2</span><span class="o">=</span><span class="n">delta</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">lmbd</span><span class="o">-</span><span class="mf">2.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">set_onsite</span><span class="p">([</span><span class="n">onsite_0</span><span class="p">,</span><span class="n">onsite_1</span><span class="p">,</span><span class="n">onsite_2</span><span class="p">])</span>
    <span class="k">return</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

<span class="c1"># set model parameters</span>
<span class="n">delta</span><span class="o">=</span><span class="mf">2.0</span>
<span class="n">t</span><span class="o">=-</span><span class="mf">1.3</span>

<span class="c1"># evolve tight-binding parameter lambda along a path</span>
<span class="n">path_steps</span><span class="o">=</span><span class="mi">21</span>
<span class="n">all_lambda</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="n">path_steps</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># get model at arbitrary lambda for initializations</span>
<span class="n">my_model</span><span class="o">=</span><span class="n">set_model</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">delta</span><span class="p">,</span><span class="mf">0.</span><span class="p">)</span>

<span class="c1"># set up 1d Brillouin zone mesh</span>
<span class="n">num_kpt</span><span class="o">=</span><span class="mi">31</span>
<span class="p">(</span><span class="n">k_vec</span><span class="p">,</span><span class="n">k_dist</span><span class="p">,</span><span class="n">k_node</span><span class="p">)</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">k_path</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">],[</span><span class="mf">0.5</span><span class="p">]],</span><span class="n">num_kpt</span><span class="p">,</span><span class="n">report</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># two-dimensional wf_array in which we will store wavefunctions</span>
<span class="c1"># we store it in the order [lambda,k] since want Berry curvatures</span>
<span class="c1">#   and Chern numbers defined with the [lambda,k] sign convention</span>
<span class="n">wf_kpt_lambda</span><span class="o">=</span><span class="n">wf_array</span><span class="p">(</span><span class="n">my_model</span><span class="p">,[</span><span class="n">path_steps</span><span class="p">,</span><span class="n">num_kpt</span><span class="p">])</span>

<span class="c1"># fill the array with eigensolutions</span>
<span class="k">for</span> <span class="n">i_lambda</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">path_steps</span><span class="p">):</span>
    <span class="n">lmbd</span><span class="o">=</span><span class="n">all_lambda</span><span class="p">[</span><span class="n">i_lambda</span><span class="p">]</span>
    <span class="n">my_model</span><span class="o">=</span><span class="n">set_model</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">delta</span><span class="p">,</span><span class="n">lmbd</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">eval</span><span class="p">,</span><span class="n">evec</span><span class="p">)</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">solve_all</span><span class="p">(</span><span class="n">k_vec</span><span class="p">,</span><span class="n">eig_vectors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i_kpt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_kpt</span><span class="p">):</span>
        <span class="n">wf_kpt_lambda</span><span class="p">[</span><span class="n">i_lambda</span><span class="p">,</span><span class="n">i_kpt</span><span class="p">]</span><span class="o">=</span><span class="n">evec</span><span class="p">[:,</span><span class="n">i_kpt</span><span class="p">,:]</span>

<span class="c1"># compute integrated curvature</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Chern numbers for rising fillings&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Band  0     = </span><span class="si">%5.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">wf_kpt_lambda</span><span class="o">.</span><span class="n">berry_flux</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Bands 0,1   = </span><span class="si">%5.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">wf_kpt_lambda</span><span class="o">.</span><span class="n">berry_flux</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Bands 0,1,2 = </span><span class="si">%5.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">wf_kpt_lambda</span><span class="o">.</span><span class="n">berry_flux</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Chern numbers for individual bands&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Band  0 = </span><span class="si">%5.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">wf_kpt_lambda</span><span class="o">.</span><span class="n">berry_flux</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Band  1 = </span><span class="si">%5.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">wf_kpt_lambda</span><span class="o">.</span><span class="n">berry_flux</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Band  2 = </span><span class="si">%5.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">wf_kpt_lambda</span><span class="o">.</span><span class="n">berry_flux</span><span class="p">([</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="c1"># for annotating plot with text</span>
<span class="n">text_lower</span><span class="o">=</span><span class="s2">&quot;C of band [0] = </span><span class="si">%3.0f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">wf_kpt_lambda</span><span class="o">.</span><span class="n">berry_flux</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
<span class="n">text_upper</span><span class="o">=</span><span class="s2">&quot;C of bands [0,1] = </span><span class="si">%3.0f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">wf_kpt_lambda</span><span class="o">.</span><span class="n">berry_flux</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>

<span class="c1"># now loop over parameter again, this time for finite chains</span>
<span class="n">path_steps</span><span class="o">=</span><span class="mi">241</span>
<span class="n">all_lambda</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="n">path_steps</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># length of chain, in unit cells</span>
<span class="n">num_cells</span><span class="o">=</span><span class="mi">10</span>
<span class="n">num_orb</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="n">num_cells</span>

<span class="c1"># initialize array for chain eigenvalues and x expectations</span>
<span class="n">ch_eval</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">num_orb</span><span class="p">,</span><span class="n">path_steps</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">ch_xexp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">num_orb</span><span class="p">,</span><span class="n">path_steps</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i_lambda</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">path_steps</span><span class="p">):</span>
    <span class="n">lmbd</span><span class="o">=</span><span class="n">all_lambda</span><span class="p">[</span><span class="n">i_lambda</span><span class="p">]</span>

    <span class="c1"># construct and solve model</span>
    <span class="n">my_model</span><span class="o">=</span><span class="n">set_model</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">delta</span><span class="p">,</span><span class="n">lmbd</span><span class="p">)</span>
    <span class="n">ch_model</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">cut_piece</span><span class="p">(</span><span class="n">num_cells</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">eval</span><span class="p">,</span><span class="n">evec</span><span class="p">)</span><span class="o">=</span><span class="n">ch_model</span><span class="o">.</span><span class="n">solve_all</span><span class="p">(</span><span class="n">eig_vectors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># save eigenvalues</span>
    <span class="n">ch_eval</span><span class="p">[:,</span><span class="n">i_lambda</span><span class="p">]</span><span class="o">=</span><span class="nb">eval</span>
    <span class="n">ch_xexp</span><span class="p">[:,</span><span class="n">i_lambda</span><span class="p">]</span><span class="o">=</span><span class="n">ch_model</span><span class="o">.</span><span class="n">position_expectation</span><span class="p">(</span><span class="n">evec</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># plot eigenvalues vs. lambda</span>
<span class="c1"># symbol size is reduced for states localized near left end</span>

<span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="c1"># loop over &quot;bands&quot;</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_orb</span><span class="p">):</span>
    <span class="c1"># diminish the size of the ones on the borderline</span>
    <span class="n">xcut</span><span class="o">=</span><span class="mf">2.</span>   <span class="c1"># discard points below this</span>
    <span class="n">xfull</span><span class="o">=</span><span class="mf">4.</span>  <span class="c1"># use sybols of full size above this</span>
    <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">ch_xexp</span><span class="p">[</span><span class="n">n</span><span class="p">,:]</span><span class="o">-</span><span class="n">xcut</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">xfull</span><span class="o">-</span><span class="n">xcut</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">path_steps</span><span class="p">):</span>
        <span class="n">size</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mf">1.</span><span class="p">)</span>
        <span class="n">size</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">all_lambda</span><span class="p">[:],</span><span class="n">ch_eval</span><span class="p">[</span><span class="n">n</span><span class="p">,:],</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">size</span><span class="o">*</span><span class="mf">6.</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="c1"># annotate gaps with bulk Chern numbers calculated earlier</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.20</span><span class="p">,</span><span class="o">-</span><span class="mf">1.7</span><span class="p">,</span><span class="n">text_lower</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.45</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span><span class="n">text_upper</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Eigenenergies for finite chain of 3-site-model&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Parameter $\lambda$&quot;</span><span class="p">)</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Energy&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;3site_endstates.pdf&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/8c5d7af3a8cd0142916663b644cb6907/3site_cycle_fin.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/8af0c8a34cd6b071d5a2bc55bd7a8740/3site_cycle_fin.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/eaa430523c5a69336c343b2c3bf672ff/3site_cycle_fin.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/3site_cycle_fin.png" class="plot-directive" src="_images/3site_cycle_fin.png" />
</figure>
</section>
<section id="haldane-model">
<span id="haldane-example"></span><h2>Haldane model<a class="headerlink" href="#haldane-model" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="http://link.aps.org/doi/10.1103/PhysRevLett.61.2015">Haldane model</a>
is a graphene model with complex second neighbour hoppings.</p>
<p>Here we have calculated the density of states as well.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1"># Haldane model from Phys. Rev. Lett. 61, 2015 (1988)</span>

<span class="c1"># Copyright under GNU General Public License 2010, 2012, 2016</span>
<span class="c1"># by Sinisa Coh and David Vanderbilt (see gpl-pythtb.txt)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pythtb</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span> <span class="c1"># import TB model class</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># define lattice vectors</span>
<span class="n">lat</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.5</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">]]</span>
<span class="c1"># define coordinates of orbitals</span>
<span class="n">orb</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">],[</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">]]</span>

<span class="c1"># make two dimensional tight-binding Haldane model</span>
<span class="n">my_model</span><span class="o">=</span><span class="n">tb_model</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">orb</span><span class="p">)</span>

<span class="c1"># set model parameters</span>
<span class="n">delta</span><span class="o">=</span><span class="mf">0.2</span>
<span class="n">t</span><span class="o">=-</span><span class="mf">1.0</span>
<span class="n">t2</span> <span class="o">=</span><span class="mf">0.15</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="mf">1.</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
<span class="n">t2c</span><span class="o">=</span><span class="n">t2</span><span class="o">.</span><span class="n">conjugate</span><span class="p">()</span>

<span class="c1"># set on-site energies</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_onsite</span><span class="p">([</span><span class="o">-</span><span class="n">delta</span><span class="p">,</span><span class="n">delta</span><span class="p">])</span>
<span class="c1"># set hoppings (one for each connected pair of orbitals)</span>
<span class="c1"># (amplitude, i, j, [lattice vector to cell containing j])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="c1"># add second neighbour complex hoppings</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t2</span> <span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t2</span> <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t2</span> <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t2c</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t2c</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t2c</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="c1"># print tight-binding model</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>

<span class="c1"># generate list of k-points following a segmented path in the BZ</span>
<span class="c1"># list of nodes (high-symmetry points) that will be connected</span>
<span class="n">path</span><span class="o">=</span><span class="p">[[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">],[</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">],[</span><span class="mf">.5</span><span class="p">,</span><span class="mf">.5</span><span class="p">],[</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">]]</span>
<span class="c1"># labels of the nodes</span>
<span class="n">label</span><span class="o">=</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Gamma $&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$K$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$M$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$K^\prime$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\Gamma $&#39;</span><span class="p">)</span>

<span class="c1"># call function k_path to construct the actual path</span>
<span class="p">(</span><span class="n">k_vec</span><span class="p">,</span><span class="n">k_dist</span><span class="p">,</span><span class="n">k_node</span><span class="p">)</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">k_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="mi">101</span><span class="p">)</span>
<span class="c1"># inputs:</span>
<span class="c1">#   path: see above</span>
<span class="c1">#   101: number of interpolated k-points to be plotted</span>
<span class="c1"># outputs:</span>
<span class="c1">#   k_vec: list of interpolated k-points</span>
<span class="c1">#   k_dist: horizontal axis position of each k-point in the list</span>
<span class="c1">#   k_node: horizontal axis position of each original node</span>

<span class="c1"># obtain eigenvalues to be plotted</span>
<span class="n">evals</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">solve_all</span><span class="p">(</span><span class="n">k_vec</span><span class="p">)</span>

<span class="c1"># figure for bandstructure</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="c1"># specify horizontal axis details</span>
<span class="c1"># set range of horizontal axis</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">k_node</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">k_node</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="c1"># put tickmarks and labels at node positions</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">k_node</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
<span class="c1"># add vertical lines at node positions</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k_node</span><span class="p">)):</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">k_node</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="c1"># put title</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Haldane model band structure&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Path in k-space&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Band energy&quot;</span><span class="p">)</span>

<span class="c1"># plot first band</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_dist</span><span class="p">,</span><span class="n">evals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c1"># plot second band</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_dist</span><span class="p">,</span><span class="n">evals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># make an PDF figure of a plot</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;haldane_band.pdf&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------------------------------&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;starting DOS calculation&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------------------------------&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Calculating DOS...&#39;</span><span class="p">)</span>

<span class="c1"># calculate density of states</span>
<span class="c1"># first solve the model on a mesh and return all energies</span>
<span class="n">kmesh</span><span class="o">=</span><span class="mi">20</span>
<span class="n">kpts</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">kmesh</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">kmesh</span><span class="p">):</span>
        <span class="n">kpts</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">kmesh</span><span class="p">),</span><span class="nb">float</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">kmesh</span><span class="p">)])</span>
<span class="c1"># solve the model on this mesh</span>
<span class="n">evals</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">solve_all</span><span class="p">(</span><span class="n">kpts</span><span class="p">)</span>
<span class="c1"># flatten completely the matrix</span>
<span class="n">evals</span><span class="o">=</span><span class="n">evals</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="c1"># plotting DOS</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plotting DOS...&#39;</span><span class="p">)</span>

<span class="c1"># now plot density of states</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">evals</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">4.</span><span class="p">,</span><span class="mf">4.</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">80.0</span><span class="p">)</span>
<span class="c1"># put title</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Haldane model density of states&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Band energy&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Number of states&quot;</span><span class="p">)</span>
<span class="c1"># make an PDF figure of a plot</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;haldane_dos.pdf&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/01ccb11ab6c2d936a91d2659ee7c318a/haldane.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>)</p>
<figure class="align-default" id="id7">
<img alt="_images/haldane_00.png" class="plot-directive" src="_images/haldane_00.png" />
<figcaption>
<p><span class="caption-text">(<a class="reference download internal" download="" href="_downloads/8120514bbf61905bf9dfbc6b2f85316a/haldane_00.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/3b8b70b0f879024a8f2861a7477f4475/haldane_00.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</span><a class="headerlink" href="#id7" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id8">
<img alt="_images/haldane_01.png" class="plot-directive" src="_images/haldane_01.png" />
<figcaption>
<p><span class="caption-text">(<a class="reference download internal" download="" href="_downloads/683414aa997f4daf33a424a31819cd3e/haldane_01.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/c8ab856af5812edd3c03c89e46a87b4c/haldane_01.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</span><a class="headerlink" href="#id8" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="finite-haldane-model">
<span id="haldane-fin-example"></span><h2>Finite Haldane model<a class="headerlink" href="#finite-haldane-model" title="Link to this heading">¶</a></h2>
<p>Now let us calculate the density of states for a finite piece of the Haldane
model with and without periodic boundary conditions (PBC).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1"># Haldane model from Phys. Rev. Lett. 61, 2015 (1988)</span>
<span class="c1"># Calculates density of states for finite sample of Haldane model</span>

<span class="c1"># Copyright under GNU General Public License 2010, 2012, 2016</span>
<span class="c1"># by Sinisa Coh and David Vanderbilt (see gpl-pythtb.txt)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pythtb</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span> <span class="c1"># import TB model class</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># define lattice vectors</span>
<span class="n">lat</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.5</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">]]</span>
<span class="c1"># define coordinates of orbitals</span>
<span class="n">orb</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">],[</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">]]</span>

<span class="c1"># make two dimensional tight-binding Haldane model</span>
<span class="n">my_model</span><span class="o">=</span><span class="n">tb_model</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">orb</span><span class="p">)</span>

<span class="c1"># set model parameters</span>
<span class="n">delta</span><span class="o">=</span><span class="mf">0.0</span>
<span class="n">t</span><span class="o">=-</span><span class="mf">1.0</span>
<span class="n">t2</span> <span class="o">=</span><span class="mf">0.15</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="mf">1.</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
<span class="n">t2c</span><span class="o">=</span><span class="n">t2</span><span class="o">.</span><span class="n">conjugate</span><span class="p">()</span>

<span class="c1"># set on-site energies</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_onsite</span><span class="p">([</span><span class="o">-</span><span class="n">delta</span><span class="p">,</span><span class="n">delta</span><span class="p">])</span>
<span class="c1"># set hoppings (one for each connected pair of orbitals)</span>
<span class="c1"># (amplitude, i, j, [lattice vector to cell containing j])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="c1"># add second neighbour complex hoppings</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t2</span> <span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t2</span> <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t2</span> <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t2c</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t2c</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t2c</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="c1"># print tight-binding model details</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>

<span class="c1"># cutout finite model first along direction x with no PBC</span>
<span class="n">tmp_model</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">cut_piece</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">glue_edgs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># cutout also along y direction</span>
<span class="n">fin_model_false</span><span class="o">=</span><span class="n">tmp_model</span><span class="o">.</span><span class="n">cut_piece</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">glue_edgs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># cutout finite model first along direction x with PBC</span>
<span class="n">tmp_model</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">cut_piece</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">glue_edgs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># cutout also along y direction</span>
<span class="n">fin_model_true</span><span class="o">=</span><span class="n">tmp_model</span><span class="o">.</span><span class="n">cut_piece</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">glue_edgs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># solve finite model</span>
<span class="n">evals_false</span><span class="o">=</span><span class="n">fin_model_false</span><span class="o">.</span><span class="n">solve_all</span><span class="p">()</span>
<span class="n">evals_false</span><span class="o">=</span><span class="n">evals_false</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">evals_true</span><span class="o">=</span><span class="n">fin_model_true</span><span class="o">.</span><span class="n">solve_all</span><span class="p">()</span>
<span class="n">evals_true</span><span class="o">=</span><span class="n">evals_true</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="c1"># now plot density of states</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">evals_false</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">4.</span><span class="p">,</span><span class="mf">4.</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">80.0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Finite Haldane model without PBC&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Band energy&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Number of states&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;haldane_fin_dos_false.pdf&quot;</span><span class="p">)</span>  
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">evals_true</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">4.</span><span class="p">,</span><span class="mf">4.</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">80.0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Finite Haldane model with PBC&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Band energy&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Number of states&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;haldane_fin_dos_true.pdf&quot;</span><span class="p">)</span>  

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/2657a8e86cbf24f8641993b0ec9d9e96/haldane_fin.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>)</p>
<figure class="align-default" id="id9">
<img alt="_images/haldane_fin_00.png" class="plot-directive" src="_images/haldane_fin_00.png" />
<figcaption>
<p><span class="caption-text">(<a class="reference download internal" download="" href="_downloads/0e62717b52742fb0796f1fadc5adb66b/haldane_fin_00.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/dd1877e3d8aaaac7f66f1596362afb29/haldane_fin_00.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</span><a class="headerlink" href="#id9" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id10">
<img alt="_images/haldane_fin_01.png" class="plot-directive" src="_images/haldane_fin_01.png" />
<figcaption>
<p><span class="caption-text">(<a class="reference download internal" download="" href="_downloads/be44fff0d1fcd52ee506ac8a6bd6067f/haldane_fin_01.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/81a8521fefa89008bb3b3b664bb80ddd/haldane_fin_01.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</span><a class="headerlink" href="#id10" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="edge-states">
<span id="edge-example"></span><h2>Edge states<a class="headerlink" href="#edge-states" title="Link to this heading">¶</a></h2>
<p>Plots the edge state-eigenfunction for a finite Haldane model that
is periodic either in both directions or in only one direction.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1"># Haldane model from Phys. Rev. Lett. 61, 2015 (1988)</span>
<span class="c1"># Solves model and draws one of its edge states.</span>

<span class="c1"># Copyright under GNU General Public License 2010, 2012, 2016</span>
<span class="c1"># by Sinisa Coh and David Vanderbilt (see gpl-pythtb.txt)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pythtb</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span> <span class="c1"># import TB model class</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="c1"># define lattice vectors</span>
<span class="n">lat</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.5</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">]]</span>
<span class="c1"># define coordinates of orbitals</span>
<span class="n">orb</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">],[</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">]]</span>

<span class="c1"># make two dimensional tight-binding Haldane model</span>
<span class="n">my_model</span><span class="o">=</span><span class="n">tb_model</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">orb</span><span class="p">)</span>

<span class="c1"># set model parameters</span>
<span class="n">delta</span><span class="o">=</span><span class="mf">0.0</span>
<span class="n">t</span><span class="o">=-</span><span class="mf">1.0</span>
<span class="n">t2</span> <span class="o">=</span><span class="mf">0.15</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="mf">1.</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
<span class="n">t2c</span><span class="o">=</span><span class="n">t2</span><span class="o">.</span><span class="n">conjugate</span><span class="p">()</span>

<span class="c1"># set on-site energies</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_onsite</span><span class="p">([</span><span class="o">-</span><span class="n">delta</span><span class="p">,</span><span class="n">delta</span><span class="p">])</span>
<span class="c1"># set hoppings (one for each connected pair of orbitals)</span>
<span class="c1"># (amplitude, i, j, [lattice vector to cell containing j])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="c1"># add second neighbour complex hoppings</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t2</span> <span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t2</span> <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t2</span> <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t2c</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t2c</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t2c</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="c1"># print tight-binding model details</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>

<span class="c1"># cutout finite model first along direction x with no PBC</span>
<span class="n">tmp_model</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">cut_piece</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">glue_edgs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># cutout also along y direction with no PBC</span>
<span class="n">fin_model</span><span class="o">=</span><span class="n">tmp_model</span><span class="o">.</span><span class="n">cut_piece</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">glue_edgs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># cutout finite model first along direction x with PBC</span>
<span class="n">tmp_model_half</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">cut_piece</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">glue_edgs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># cutout also along y direction with no PBC</span>
<span class="n">fin_model_half</span><span class="o">=</span><span class="n">tmp_model_half</span><span class="o">.</span><span class="n">cut_piece</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">glue_edgs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># solve finite models</span>
<span class="p">(</span><span class="n">evals</span><span class="p">,</span><span class="n">evecs</span><span class="p">)</span><span class="o">=</span><span class="n">fin_model</span><span class="o">.</span><span class="n">solve_all</span><span class="p">(</span><span class="n">eig_vectors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">(</span><span class="n">evals_half</span><span class="p">,</span><span class="n">evecs_half</span><span class="p">)</span><span class="o">=</span><span class="n">fin_model_half</span><span class="o">.</span><span class="n">solve_all</span><span class="p">(</span><span class="n">eig_vectors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># pick index of state in the middle of the gap</span>
<span class="n">ed</span><span class="o">=</span><span class="n">fin_model</span><span class="o">.</span><span class="n">get_num_orbitals</span><span class="p">()</span><span class="o">//</span><span class="mi">2</span>

<span class="c1"># draw one of the edge states in both cases</span>
<span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span><span class="o">=</span><span class="n">fin_model</span><span class="o">.</span><span class="n">visualize</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">eig_dr</span><span class="o">=</span><span class="n">evecs</span><span class="p">[</span><span class="n">ed</span><span class="p">,:],</span><span class="n">draw_hoppings</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Edge state for finite model without periodic direction&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x coordinate&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;y coordinate&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;edge_state.pdf&quot;</span><span class="p">)</span>
<span class="c1">#</span>
<span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span><span class="o">=</span><span class="n">fin_model_half</span><span class="o">.</span><span class="n">visualize</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">eig_dr</span><span class="o">=</span><span class="n">evecs_half</span><span class="p">[</span><span class="n">ed</span><span class="p">,:],</span><span class="n">draw_hoppings</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Edge state for finite model periodic in one direction&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x coordinate&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;y coordinate&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;edge_state_half.pdf&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/02bf5c48959e1289b65b3075db202a78/edge.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>)</p>
<figure class="align-default" id="id11">
<img alt="_images/edge_00.png" class="plot-directive" src="_images/edge_00.png" />
<figcaption>
<p><span class="caption-text">(<a class="reference download internal" download="" href="_downloads/07c368463a8bf3fe3597e89675f1162a/edge_00.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/e0242f270fc9330f899259dc17b48d1a/edge_00.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</span><a class="headerlink" href="#id11" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id12">
<img alt="_images/edge_01.png" class="plot-directive" src="_images/edge_01.png" />
<figcaption>
<p><span class="caption-text">(<a class="reference download internal" download="" href="_downloads/04a4486d313f962b894958d255e7ba40/edge_01.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/8f33c5813f2f765edce3e532415ae891/edge_01.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</span><a class="headerlink" href="#id12" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="berry-phases-in-haldane-model">
<span id="haldane-bp-example"></span><h2>Berry phases in Haldane model<a class="headerlink" href="#berry-phases-in-haldane-model" title="Link to this heading">¶</a></h2>
<p>Calculate Berry phases along <img class="math" src="_images/math/dd0e5d9b7f5db2ce4081948acf7301aac2141fbe.png" alt="k_x"/> (which are proportional
to the 1D Wannier center positions along <img class="math" src="_images/math/888f7c323ac0341871e867220ae2d76467d74d6e.png" alt="x"/>) as a function
of <img class="math" src="_images/math/b0f9e558be99db329bb3c4c3df9ccf08b74f3bf1.png" alt="k_y"/> for the Haldane model.  This is done first for each
band separately, then for both together.  Two different approaches,
one less and one more automated, are illustrated.  The results
indicate that the two bands have equal and opposite Chern
numbers. Finally, the Berry curvature is calculated and printed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1"># Haldane model from Phys. Rev. Lett. 61, 2015 (1988)</span>
<span class="c1"># Calculates Berry phases and curvatures for this model</span>

<span class="c1"># Copyright under GNU General Public License 2010, 2012, 2016</span>
<span class="c1"># by Sinisa Coh and David Vanderbilt (see gpl-pythtb.txt)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pythtb</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span> <span class="c1"># import TB model class</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># define lattice vectors</span>
<span class="n">lat</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.5</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">]]</span>
<span class="c1"># define coordinates of orbitals</span>
<span class="n">orb</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">],[</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">]]</span>

<span class="c1"># make two dimensional tight-binding Haldane model</span>
<span class="n">my_model</span><span class="o">=</span><span class="n">tb_model</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">orb</span><span class="p">)</span>

<span class="c1"># set model parameters</span>
<span class="n">delta</span><span class="o">=</span><span class="mf">0.0</span>
<span class="n">t</span><span class="o">=-</span><span class="mf">1.0</span>
<span class="n">t2</span> <span class="o">=</span><span class="mf">0.15</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="mf">1.</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
<span class="n">t2c</span><span class="o">=</span><span class="n">t2</span><span class="o">.</span><span class="n">conjugate</span><span class="p">()</span>

<span class="c1"># set on-site energies</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_onsite</span><span class="p">([</span><span class="o">-</span><span class="n">delta</span><span class="p">,</span><span class="n">delta</span><span class="p">])</span>
<span class="c1"># set hoppings (one for each connected pair of orbitals)</span>
<span class="c1"># (amplitude, i, j, [lattice vector to cell containing j])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="c1"># add second neighbour complex hoppings</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t2</span> <span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t2</span> <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t2</span> <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t2c</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t2c</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t2c</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="c1"># print tight-binding model details</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Using approach #1&quot;</span><span class="p">)</span>
<span class="c1"># approach #1</span>
<span class="c1"># generate object of type wf_array that will be used for</span>
<span class="c1"># Berry phase and curvature calculations</span>
<span class="n">my_array_1</span><span class="o">=</span><span class="n">wf_array</span><span class="p">(</span><span class="n">my_model</span><span class="p">,[</span><span class="mi">31</span><span class="p">,</span><span class="mi">31</span><span class="p">])</span>
<span class="c1"># solve model on a regular grid, and put origin of</span>
<span class="c1"># Brillouin zone at -1/2 -1/2 point</span>
<span class="n">my_array_1</span><span class="o">.</span><span class="n">solve_on_grid</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">])</span>

<span class="c1"># calculate Berry phases around the BZ in the k_x direction</span>
<span class="c1"># (which can be interpreted as the 1D hybrid Wannier center</span>
<span class="c1"># in the x direction) and plot results as a function of k_y</span>
<span class="c1">#</span>
<span class="c1"># Berry phases along k_x for lower band</span>
<span class="n">phi_a_1</span> <span class="o">=</span> <span class="n">my_array_1</span><span class="o">.</span><span class="n">berry_phase</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="n">contin</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Berry phases along k_x for upper band</span>
<span class="n">phi_b_1</span> <span class="o">=</span> <span class="n">my_array_1</span><span class="o">.</span><span class="n">berry_phase</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="n">contin</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Berry phases along k_x for both bands</span>
<span class="n">phi_c_1</span> <span class="o">=</span> <span class="n">my_array_1</span><span class="o">.</span><span class="n">berry_phase</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="n">contin</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Berry flux for lower band</span>
<span class="n">flux_a_1</span><span class="o">=</span><span class="n">my_array_1</span><span class="o">.</span><span class="n">berry_flux</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># plot Berry phases</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ky</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">phi_a_1</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ky</span><span class="p">,</span><span class="n">phi_a_1</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ky</span><span class="p">,</span><span class="n">phi_b_1</span><span class="p">,</span> <span class="s1">&#39;go&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ky</span><span class="p">,</span><span class="n">phi_c_1</span><span class="p">,</span> <span class="s1">&#39;bo&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Berry phase for lower (red), top (green), both bands (blue)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$k_y$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Berry phase along $k_x$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">7.</span><span class="p">,</span><span class="mf">7.</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([</span><span class="o">-</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">((</span><span class="sa">r</span><span class="s1">&#39;$-2\pi$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$-\pi$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$0$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\pi$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$2\pi$&#39;</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;haldane_bp_phase.pdf&quot;</span><span class="p">)</span>
<span class="c1"># print out info about flux</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Berry flux= &quot;</span><span class="p">,</span><span class="n">flux_a_1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Using approach #2&quot;</span><span class="p">)</span>
<span class="c1"># approach #2</span>
<span class="c1"># do the same thing as in approach #1 but do not use</span>
<span class="c1"># automated solver</span>
<span class="c1">#</span>
<span class="c1"># intialize k-space mesh</span>
<span class="n">nkx</span><span class="o">=</span><span class="mi">31</span>
<span class="n">nky</span><span class="o">=</span><span class="mi">31</span>
<span class="n">kx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="n">nkx</span><span class="p">)</span>
<span class="n">ky</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="n">nky</span><span class="p">)</span>
<span class="c1"># initialize object to store all wavefunctions</span>
<span class="n">my_array_2</span><span class="o">=</span><span class="n">wf_array</span><span class="p">(</span><span class="n">my_model</span><span class="p">,[</span><span class="n">nkx</span><span class="p">,</span><span class="n">nky</span><span class="p">])</span>
<span class="c1"># solve model at all k-points</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nkx</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nky</span><span class="p">):</span>
        <span class="p">(</span><span class="nb">eval</span><span class="p">,</span><span class="n">evec</span><span class="p">)</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">solve_one</span><span class="p">([</span><span class="n">kx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">ky</span><span class="p">[</span><span class="n">j</span><span class="p">]],</span><span class="n">eig_vectors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># store wavefunctions</span>
        <span class="n">my_array_2</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">evec</span>
<span class="c1"># impose periodic boundary conditions in both k_x and k_y directions</span>
<span class="n">my_array_2</span><span class="o">.</span><span class="n">impose_pbc</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">my_array_2</span><span class="o">.</span><span class="n">impose_pbc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># calculate Berry flux for lower band</span>
<span class="n">flux_a_2</span><span class="o">=</span><span class="n">my_array_2</span><span class="o">.</span><span class="n">berry_flux</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># print out info about curvature</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Berry flux= &quot;</span><span class="p">,</span><span class="n">flux_a_2</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/7acaa584e702f89050d36bed2a969b8f/haldane_bp.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/9824c5d571abac6c987e02de5cca6e96/haldane_bp.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/1788f96c5e77a5956aaadca960454f3d/haldane_bp.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/haldane_bp.png" class="plot-directive" src="_images/haldane_bp.png" />
</figure>
</section>
<section id="hybrid-wannier-centers-in-haldane-model">
<span id="haldane-hwf-example"></span><h2>Hybrid Wannier centers in Haldane model<a class="headerlink" href="#hybrid-wannier-centers-in-haldane-model" title="Link to this heading">¶</a></h2>
<p>Calculates Berry phases for the Haldane model and compares it to the
hybrid Wannier centers for a ribbon of the Haldane model.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1"># Haldane model from Phys. Rev. Lett. 61, 2015 (1988)</span>
<span class="c1"># First, compute bulk Wannier centers along direction 1</span>
<span class="c1"># Then, cut a ribbon that extends along direcion 0, and compute</span>
<span class="c1">#   both the edge states and the finite hybrid Wannier centers</span>
<span class="c1">#   along direction 1.</span>

<span class="c1"># Copyright under GNU General Public License 2010, 2012, 2016</span>
<span class="c1"># by Sinisa Coh and David Vanderbilt (see gpl-pythtb.txt)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pythtb</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span> <span class="c1"># import TB model class</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># set model parameters</span>
<span class="n">delta</span><span class="o">=-</span><span class="mf">0.2</span>
<span class="n">t</span><span class="o">=-</span><span class="mf">1.0</span>
<span class="n">t2</span> <span class="o">=</span><span class="mf">0.05</span><span class="o">-</span><span class="mf">0.15</span><span class="n">j</span>
<span class="n">t2c</span><span class="o">=</span><span class="n">t2</span><span class="o">.</span><span class="n">conjugate</span><span class="p">()</span>

<span class="c1"># Fermi level, relevant for edge states of ribbon</span>
<span class="n">efermi</span><span class="o">=</span><span class="mf">0.25</span>  

<span class="c1"># define lattice vectors and orbitals and make model</span>
<span class="n">lat</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.5</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">]]</span>
<span class="n">orb</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">],[</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">]]</span>
<span class="n">my_model</span><span class="o">=</span><span class="n">tb_model</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">orb</span><span class="p">)</span>

<span class="c1"># set on-site energies and hoppings</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_onsite</span><span class="p">([</span><span class="o">-</span><span class="n">delta</span><span class="p">,</span><span class="n">delta</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t2</span> <span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t2</span> <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t2</span> <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t2c</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t2c</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t2c</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="c1"># number of discretized sites or k-points in the mesh in directions 0 and 1</span>
<span class="n">len_0</span><span class="o">=</span><span class="mi">100</span>
<span class="n">len_1</span><span class="o">=</span><span class="mi">10</span>

<span class="c1"># compute Berry phases in direction 1 for the bottom band</span>
<span class="n">my_array</span><span class="o">=</span><span class="n">wf_array</span><span class="p">(</span><span class="n">my_model</span><span class="p">,[</span><span class="n">len_0</span><span class="p">,</span><span class="n">len_1</span><span class="p">])</span>
<span class="n">my_array</span><span class="o">.</span><span class="n">solve_on_grid</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">])</span>
<span class="n">phi_1</span><span class="o">=</span><span class="n">my_array</span><span class="o">.</span><span class="n">berry_phase</span><span class="p">(</span><span class="n">occ</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">dir</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">contin</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># create Haldane ribbon that is finite along direction 1</span>
<span class="n">ribbon_model</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">cut_piece</span><span class="p">(</span><span class="n">len_1</span><span class="p">,</span> <span class="n">fin_dir</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">glue_edgs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="p">(</span><span class="n">k_vec</span><span class="p">,</span><span class="n">k_dist</span><span class="p">,</span><span class="n">k_node</span><span class="p">)</span><span class="o">=</span><span class="n">ribbon_model</span><span class="o">.</span><span class="n">k_path</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span><span class="n">len_0</span><span class="p">,</span><span class="n">report</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">k_label</span><span class="o">=</span><span class="p">[</span><span class="sa">r</span><span class="s2">&quot;$0$&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;$\pi$&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$2\pi$&quot;</span><span class="p">]</span>

<span class="c1"># solve ribbon model to get eigenvalues and eigenvectors</span>
<span class="p">(</span><span class="n">rib_eval</span><span class="p">,</span><span class="n">rib_evec</span><span class="p">)</span><span class="o">=</span><span class="n">ribbon_model</span><span class="o">.</span><span class="n">solve_all</span><span class="p">(</span><span class="n">k_vec</span><span class="p">,</span><span class="n">eig_vectors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># shift bands so that the fermi level is at zero energy</span>
<span class="n">rib_eval</span><span class="o">-=</span><span class="n">efermi</span>

<span class="c1"># find k-points at which number of states below the Fermi level changes</span>
<span class="n">jump_k</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rib_eval</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
  <span class="n">nocc_i</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rib_eval</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;</span><span class="mf">0.0</span><span class="p">)</span>
  <span class="n">nocc_ip</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rib_eval</span><span class="p">[:,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;</span><span class="mf">0.0</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">nocc_i</span><span class="o">!=</span><span class="n">nocc_ip</span><span class="p">:</span>
    <span class="n">jump_k</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

<span class="c1"># plot expectation value of position operator for states in the ribbon</span>
<span class="c1"># and hybrid Wannier function centers</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">3.7</span><span class="p">,</span><span class="mf">4.5</span><span class="p">))</span>

<span class="c1"># plot bandstructure of the ribbon</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rib_eval</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
  <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_dist</span><span class="p">,</span><span class="n">rib_eval</span><span class="p">[</span><span class="n">n</span><span class="p">,:],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">50</span><span class="p">)</span>

<span class="c1"># color bands according to expectation value of y operator (red=top, blue=bottom)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rib_evec</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
  <span class="c1"># get expectation value of the position operator for states at i-th kpoint</span>
  <span class="n">pos_exp</span><span class="o">=</span><span class="n">ribbon_model</span><span class="o">.</span><span class="n">position_expectation</span><span class="p">(</span><span class="n">rib_evec</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span><span class="nb">dir</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

  <span class="c1"># plot states according to the expectation value</span>
  <span class="n">s</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">k_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">*</span><span class="n">rib_eval</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rib_eval</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">pos_exp</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">len_1</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># color scale</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="n">ax1</span><span class="p">,</span><span class="n">ticks</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">len_1</span><span class="p">)])</span>

<span class="c1"># plot Fermi energy</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=-</span><span class="mi">200</span><span class="p">)</span>

<span class="c1"># vertical lines show crossings of surface bands with Fermi energy</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">]:</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">jump_k</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">(</span><span class="n">k_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">k_vec</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=-</span><span class="mi">150</span><span class="p">)</span>

<span class="c1"># tweaks</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Ribbon band energy&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">2.3</span><span class="p">,</span><span class="mf">2.3</span><span class="p">)</span>

<span class="c1"># bottom plot shows Wannier center flow</span>
<span class="c1">#   bulk Wannier centers in green lines</span>
<span class="c1">#   finite-ribbon Wannier centers in black dots</span>
<span class="c1"># compare with Fig 3 in Phys. Rev. Lett. 102, 107603 (2009)</span>

<span class="c1"># plot bulk hybrid Wannier center positions and their periodic images</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">len_1</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_vec</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="n">phi_1</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=-</span><span class="mi">50</span><span class="p">)</span>

<span class="c1"># plot finite centers of ribbon along direction 1</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rib_evec</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
  <span class="c1"># get occupied states only (those below Fermi level)</span>
  <span class="n">occ_evec</span><span class="o">=</span><span class="n">rib_evec</span><span class="p">[</span><span class="n">rib_eval</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;</span><span class="mf">0.0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>
  <span class="c1"># get centers of hybrid wannier functions</span>
  <span class="n">hwfc</span><span class="o">=</span><span class="n">ribbon_model</span><span class="o">.</span><span class="n">position_hwf</span><span class="p">(</span><span class="n">occ_evec</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">hwfc</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
  <span class="c1"># plot centers</span>
  <span class="n">s</span><span class="o">=</span><span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">k_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">*</span><span class="n">hwfc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">hwfc</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">hwfc</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">len_1</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># color scale</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="n">ax2</span><span class="p">,</span><span class="n">ticks</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">len_1</span><span class="p">)])</span>

<span class="c1"># tweaks</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;k vector along direction 0&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Wannier center along direction 1&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="n">len_1</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># label both axes</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">]:</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">k_node</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">k_node</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">k_node</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">k_label</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;haldane_hwf.pdf&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/e3cb34786d41871bbb604707d318f4c6/haldane_hwf.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/e896343790c0705fb685c8df375881e0/haldane_hwf.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/6bc3ebffddd654705e55f25eeeea9375/haldane_hwf.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/haldane_hwf.png" class="plot-directive" src="_images/haldane_hwf.png" />
</figure>
</section>
<section id="kane-mele-model-using-spinor-features">
<span id="kane-mele-example"></span><h2>Kane-Mele model using spinor features<a class="headerlink" href="#kane-mele-model-using-spinor-features" title="Link to this heading">¶</a></h2>
<p>Calculate the band structure of the Kane-Mele model, illustrating
the use of spinor features of the code.  Also compute the 1D
Wannier centers along <img class="math" src="_images/math/888f7c323ac0341871e867220ae2d76467d74d6e.png" alt="x"/> as a function of <img class="math" src="_images/math/b0f9e558be99db329bb3c4c3df9ccf08b74f3bf1.png" alt="k_y"/>,
illustrating the determination of the <img class="math" src="_images/math/46011fd9190f47f8fb08bb484d5ceac65ef9a9f2.png" alt="Z_2"/> invariant.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1"># Two dimensional tight-binding 2D Kane-Mele model</span>
<span class="c1"># C.L. Kane and E.J. Mele, PRL 95, 146802 (2005) Eq. (1)</span>

<span class="c1"># Copyright under GNU General Public License 2010, 2012, 2016</span>
<span class="c1"># by Sinisa Coh and David Vanderbilt (see gpl-pytb.txt)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pythtb</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span> <span class="c1"># import TB model class</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_kane_mele</span><span class="p">(</span><span class="n">topological</span><span class="p">):</span>
  <span class="s2">&quot;Return a Kane-Mele model in the normal or topological phase.&quot;</span>

  <span class="c1"># define lattice vectors</span>
  <span class="n">lat</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.5</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">]]</span>
  <span class="c1"># define coordinates of orbitals</span>
  <span class="n">orb</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">],[</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">]]</span>

  <span class="c1"># make two dimensional tight-binding Kane-Mele model</span>
  <span class="n">ret_model</span><span class="o">=</span><span class="n">tb_model</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">orb</span><span class="p">,</span><span class="n">nspin</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

  <span class="c1"># set model parameters depending on whether you are in the topological</span>
  <span class="c1"># phase or not</span>
  <span class="k">if</span> <span class="n">topological</span><span class="o">==</span><span class="s2">&quot;even&quot;</span><span class="p">:</span>
    <span class="n">esite</span><span class="o">=</span><span class="mf">2.5</span>
  <span class="k">elif</span> <span class="n">topological</span><span class="o">==</span><span class="s2">&quot;odd&quot;</span><span class="p">:</span>
    <span class="n">esite</span><span class="o">=</span><span class="mf">1.0</span>
  <span class="c1"># set other parameters of the model</span>
  <span class="n">thop</span><span class="o">=</span><span class="mf">1.0</span>
  <span class="n">spin_orb</span><span class="o">=</span><span class="mf">0.6</span><span class="o">*</span><span class="n">thop</span><span class="o">*</span><span class="mf">0.5</span>
  <span class="n">rashba</span><span class="o">=</span><span class="mf">0.25</span><span class="o">*</span><span class="n">thop</span>

  <span class="c1"># set on-site energies</span>
  <span class="n">ret_model</span><span class="o">.</span><span class="n">set_onsite</span><span class="p">([</span><span class="n">esite</span><span class="p">,(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="n">esite</span><span class="p">])</span>

  <span class="c1"># set hoppings (one for each connected pair of orbitals)</span>
  <span class="c1"># (amplitude, i, j, [lattice vector to cell containing j])</span>

  <span class="c1"># useful definitions</span>
  <span class="n">sigma_x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
  <span class="n">sigma_y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
  <span class="n">sigma_z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

  <span class="c1"># spin-independent first-neighbor hoppings</span>
  <span class="n">ret_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">thop</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
  <span class="n">ret_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">thop</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
  <span class="n">ret_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">thop</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

  <span class="c1"># second-neighbour spin-orbit hoppings (s_z)</span>
  <span class="n">ret_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="n">j</span><span class="o">*</span><span class="n">spin_orb</span><span class="o">*</span><span class="n">sigma_z</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
  <span class="n">ret_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span> <span class="mf">1.</span><span class="n">j</span><span class="o">*</span><span class="n">spin_orb</span><span class="o">*</span><span class="n">sigma_z</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
  <span class="n">ret_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="n">j</span><span class="o">*</span><span class="n">spin_orb</span><span class="o">*</span><span class="n">sigma_z</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
  <span class="n">ret_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span> <span class="mf">1.</span><span class="n">j</span><span class="o">*</span><span class="n">spin_orb</span><span class="o">*</span><span class="n">sigma_z</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
  <span class="n">ret_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="n">j</span><span class="o">*</span><span class="n">spin_orb</span><span class="o">*</span><span class="n">sigma_z</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
  <span class="n">ret_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span> <span class="mf">1.</span><span class="n">j</span><span class="o">*</span><span class="n">spin_orb</span><span class="o">*</span><span class="n">sigma_z</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

  <span class="c1"># Rashba first-neighbor hoppings: (s_x)(dy)-(s_y)(d_x)</span>
  <span class="n">r3h</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
  <span class="c1"># bond unit vectors are (r3h,half) then (0,-1) then (-r3h,half)</span>
  <span class="n">ret_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="mf">1.</span><span class="n">j</span><span class="o">*</span><span class="n">rashba</span><span class="o">*</span><span class="p">(</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">sigma_x</span><span class="o">-</span><span class="n">r3h</span><span class="o">*</span><span class="n">sigma_y</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;add&quot;</span><span class="p">)</span>
  <span class="n">ret_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="mf">1.</span><span class="n">j</span><span class="o">*</span><span class="n">rashba</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="o">*</span><span class="n">sigma_x</span>            <span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;add&quot;</span><span class="p">)</span>
  <span class="n">ret_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="mf">1.</span><span class="n">j</span><span class="o">*</span><span class="n">rashba</span><span class="o">*</span><span class="p">(</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">sigma_x</span><span class="o">+</span><span class="n">r3h</span><span class="o">*</span><span class="n">sigma_y</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;add&quot;</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">ret_model</span>

<span class="c1"># now solve the model and find Wannier centers for both topological</span>
<span class="c1"># and normal phase of the model</span>
<span class="k">for</span> <span class="n">top_index</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;even&quot;</span><span class="p">,</span><span class="s2">&quot;odd&quot;</span><span class="p">]:</span>

  <span class="c1"># get the tight-binding model</span>
  <span class="n">my_model</span><span class="o">=</span><span class="n">get_kane_mele</span><span class="p">(</span><span class="n">top_index</span><span class="p">)</span>

  <span class="c1"># list of nodes (high-symmetry points) that will be connected</span>
  <span class="n">path</span><span class="o">=</span><span class="p">[[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">],[</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">],[</span><span class="mf">.5</span><span class="p">,</span><span class="mf">.5</span><span class="p">],[</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">]]</span>
  <span class="c1"># labels of the nodes</span>
  <span class="n">label</span><span class="o">=</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Gamma $&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$K$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$M$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$K^\prime$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\Gamma $&#39;</span><span class="p">)</span>
  <span class="p">(</span><span class="n">k_vec</span><span class="p">,</span><span class="n">k_dist</span><span class="p">,</span><span class="n">k_node</span><span class="p">)</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">k_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="n">report</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

  <span class="c1"># initialize figure with subplots</span>
  <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span><span class="mf">2.8</span><span class="p">))</span>

  <span class="c1"># solve for eigenenergies of hamiltonian on</span>
  <span class="c1"># the set of k-points from above</span>
  <span class="n">evals</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">solve_all</span><span class="p">(</span><span class="n">k_vec</span><span class="p">)</span>
  <span class="c1"># plot bands</span>
  <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_dist</span><span class="p">,</span><span class="n">evals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
  <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_dist</span><span class="p">,</span><span class="n">evals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
  <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_dist</span><span class="p">,</span><span class="n">evals</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
  <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_dist</span><span class="p">,</span><span class="n">evals</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
  <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Kane-Mele: &quot;</span><span class="o">+</span><span class="n">top_index</span><span class="o">+</span><span class="s2">&quot; phase&quot;</span><span class="p">)</span>
  <span class="n">ax1</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">k_node</span><span class="p">)</span>
  <span class="n">ax1</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
  <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">k_node</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">k_node</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
  <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k_node</span><span class="p">)):</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">k_node</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
  <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;k-space&quot;</span><span class="p">)</span>
  <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Energy&quot;</span><span class="p">)</span>

  <span class="c1">#calculate my-array</span>
  <span class="n">my_array</span><span class="o">=</span><span class="n">wf_array</span><span class="p">(</span><span class="n">my_model</span><span class="p">,[</span><span class="mi">41</span><span class="p">,</span><span class="mi">41</span><span class="p">])</span>

  <span class="c1"># solve model on a regular grid, and put origin of</span>
  <span class="c1"># Brillouin zone at [-1/2,-1/2]  point</span>
  <span class="n">my_array</span><span class="o">.</span><span class="n">solve_on_grid</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">])</span>

  <span class="c1"># calculate Berry phases around the BZ in the k_x direction</span>
  <span class="c1"># (which can be interpreted as the 1D hybrid Wannier centers</span>
  <span class="c1"># in the x direction) and plot results as a function of k_y</span>
  <span class="c1">#</span>
  <span class="c1"># Following the ideas in</span>
  <span class="c1">#   A.A. Soluyanov and D. Vanderbilt, PRB 83, 235401 (2011)</span>
  <span class="c1">#   R. Yu, X.L. Qi, A. Bernevig, Z. Fang and X. Dai, PRB 84, 075119 (2011)</span>
  <span class="c1"># the connectivity of these curves determines the Z2 index</span>
  <span class="c1">#</span>
  <span class="n">wan_cent</span> <span class="o">=</span> <span class="n">my_array</span><span class="o">.</span><span class="n">berry_phase</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="nb">dir</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">contin</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">berry_evals</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="n">wan_cent</span><span class="o">/=</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

  <span class="n">nky</span><span class="o">=</span><span class="n">wan_cent</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">ky</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="n">nky</span><span class="p">)</span>
  <span class="c1"># draw shifted Wannier center positions</span>
  <span class="k">for</span> <span class="n">shift</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ky</span><span class="p">,</span><span class="n">wan_cent</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">shift</span><span class="p">),</span><span class="s2">&quot;k.&quot;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ky</span><span class="p">,</span><span class="n">wan_cent</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">shift</span><span class="p">),</span><span class="s2">&quot;k.&quot;</span><span class="p">)</span>
  <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
  <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Wannier center along x&#39;</span><span class="p">)</span>
  <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$k_y$&#39;</span><span class="p">)</span>
  <span class="n">ax2</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.0</span><span class="p">])</span>
  <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
  <span class="n">ax2</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="sa">r</span><span class="s2">&quot;$0$&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;$\pi$&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$2\pi$&quot;</span><span class="p">])</span>
  <span class="n">ax2</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
  <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;1D Wannier centers: &quot;</span><span class="o">+</span><span class="n">top_index</span><span class="o">+</span><span class="s2">&quot; phase&quot;</span><span class="p">)</span>

  <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
  <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;kane_mele_&quot;</span><span class="o">+</span><span class="n">top_index</span><span class="o">+</span><span class="s2">&quot;.pdf&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/fa62719b0420fdf459368e191cbb3eb8/kane_mele.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>)</p>
<figure class="align-default" id="id13">
<img alt="_images/kane_mele_00.png" class="plot-directive" src="_images/kane_mele_00.png" />
<figcaption>
<p><span class="caption-text">(<a class="reference download internal" download="" href="_downloads/0099beaf1f587c6b0f332453147d0a68/kane_mele_00.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/84e036189b2057466cb30963f9127da4/kane_mele_00.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</span><a class="headerlink" href="#id13" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id14">
<img alt="_images/kane_mele_01.png" class="plot-directive" src="_images/kane_mele_01.png" />
<figcaption>
<p><span class="caption-text">(<a class="reference download internal" download="" href="_downloads/753396f631f82e328b1f924d3df151c0/kane_mele_01.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/fc24afd4434f4cb08eed823d231284d1/kane_mele_01.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</span><a class="headerlink" href="#id14" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="visualization-example">
<span id="visualize-example"></span><h2>Visualization example<a class="headerlink" href="#visualization-example" title="Link to this heading">¶</a></h2>
<p>Demonstrates visualization capabilities of the code.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1"># Visualization example</span>

<span class="c1"># Copyright under GNU General Public License 2010, 2012, 2016</span>
<span class="c1"># by Sinisa Coh and David Vanderbilt (see gpl-pythtb.txt)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pythtb</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span> <span class="c1"># import TB model class</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="c1"># define lattice vectors</span>
<span class="n">lat</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.5</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">]]</span>
<span class="c1"># define coordinates of orbitals</span>
<span class="n">orb</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">],[</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">]]</span>

<span class="c1"># make two dimensional tight-binding graphene model</span>
<span class="n">my_model</span><span class="o">=</span><span class="n">tb_model</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">orb</span><span class="p">)</span>

<span class="c1"># set model parameters</span>
<span class="n">delta</span><span class="o">=</span><span class="mf">0.0</span>
<span class="n">t</span><span class="o">=-</span><span class="mf">1.0</span>

<span class="c1"># set on-site energies</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_onsite</span><span class="p">([</span><span class="o">-</span><span class="n">delta</span><span class="p">,</span><span class="n">delta</span><span class="p">])</span>
<span class="c1"># set hoppings (one for each connected pair of orbitals)</span>
<span class="c1"># (amplitude, i, j, [lattice vector to cell containing j])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="c1"># visualize infinite model</span>
<span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">visualize</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Graphene, bulk&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x coordinate&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;y coordinate&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;visualize_bulk.pdf&quot;</span><span class="p">)</span>

<span class="c1"># cutout finite model along direction 0</span>
<span class="n">cut_one</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">cut_piece</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">glue_edgs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1">#</span>
<span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span><span class="o">=</span><span class="n">cut_one</span><span class="o">.</span><span class="n">visualize</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Graphene, ribbon&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x coordinate&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;y coordinate&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;visualize_ribbon.pdf&quot;</span><span class="p">)</span>

<span class="c1"># cutout finite model along direction 1 as well</span>
<span class="n">cut_two</span><span class="o">=</span><span class="n">cut_one</span><span class="o">.</span><span class="n">cut_piece</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">glue_edgs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1">#</span>
<span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span><span class="o">=</span><span class="n">cut_two</span><span class="o">.</span><span class="n">visualize</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Graphene, finite&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x coordinate&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;y coordinate&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;visualize_finite.pdf&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/1081486a3f7f563f79a2ba65cb15a96b/visualize.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>)</p>
<figure class="align-default" id="id15">
<img alt="_images/visualize_00.png" class="plot-directive" src="_images/visualize_00.png" />
<figcaption>
<p><span class="caption-text">(<a class="reference download internal" download="" href="_downloads/604ef35b89287d7fbafc3eda992ee81d/visualize_00.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/6410eef0095732cddacbec5e83da24a9/visualize_00.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</span><a class="headerlink" href="#id15" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id16">
<img alt="_images/visualize_01.png" class="plot-directive" src="_images/visualize_01.png" />
<figcaption>
<p><span class="caption-text">(<a class="reference download internal" download="" href="_downloads/9d43ffbfc3ab9be679840e91043ace85/visualize_01.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/c3e2f88ef8c4448e01b8571b6dd97cdf/visualize_01.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</span><a class="headerlink" href="#id16" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id17">
<img alt="_images/visualize_02.png" class="plot-directive" src="_images/visualize_02.png" />
<figcaption>
<p><span class="caption-text">(<a class="reference download internal" download="" href="_downloads/a8bd9d97f9c4fe58edd9dbd2538eaa4c/visualize_02.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/2d41ba81c9d5b7bb9d3ab6cb9a1eea08/visualize_02.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</span><a class="headerlink" href="#id17" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="arbitrary-graphene-surface">
<span id="supercell"></span><h2>Arbitrary graphene surface<a class="headerlink" href="#arbitrary-graphene-surface" title="Link to this heading">¶</a></h2>
<p>Using supercell generator, one can calculate and plot the
surface band structure for an arbitrary surface orientation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1"># Make arbitrary surface of the graphene model using</span>
<span class="c1"># make_supercell method.</span>

<span class="c1"># Copyright under GNU General Public License 2010, 2012, 2016</span>
<span class="c1"># by Sinisa Coh and David Vanderbilt (see gpl-pythtb.txt)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pythtb</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span> <span class="c1"># import TB model class</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># define lattice vectors</span>
<span class="n">lat</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.5</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">]]</span>
<span class="c1"># define coordinates of orbitals</span>
<span class="n">orb</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">],[</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">]]</span>

<span class="c1"># make two dimensional tight-binding graphene model</span>
<span class="n">my_model</span><span class="o">=</span><span class="n">tb_model</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">orb</span><span class="p">)</span>

<span class="c1"># set model parameters</span>
<span class="n">delta</span><span class="o">=</span><span class="mf">0.0</span>
<span class="n">t</span><span class="o">=-</span><span class="mf">1.0</span>

<span class="c1"># set on-site energies</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_onsite</span><span class="p">([</span><span class="o">-</span><span class="n">delta</span><span class="p">,</span><span class="n">delta</span><span class="p">])</span>
<span class="c1"># set hoppings (one for each connected pair of orbitals)</span>
<span class="c1"># (amplitude, i, j, [lattice vector to cell containing j])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="c1"># make the supercell of the model</span>
<span class="n">sc_model</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">make_supercell</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]],</span><span class="n">to_home</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># now make a slab of the supercell</span>
<span class="n">slab_model</span><span class="o">=</span><span class="n">sc_model</span><span class="o">.</span><span class="n">cut_piece</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">glue_edgs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># visualize slab unit cell</span>
<span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span><span class="o">=</span><span class="n">slab_model</span><span class="o">.</span><span class="n">visualize</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Graphene, arbitrary surface&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x coordinate&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;y coordinate&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;supercell_vis.pdf&quot;</span><span class="p">)</span>

<span class="c1"># compute the band structure in the entire band</span>
<span class="p">(</span><span class="n">k_vec</span><span class="p">,</span><span class="n">k_dist</span><span class="p">,</span><span class="n">k_node</span><span class="p">)</span><span class="o">=</span><span class="n">slab_model</span><span class="o">.</span><span class="n">k_path</span><span class="p">(</span><span class="s1">&#39;full&#39;</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">evals</span><span class="o">=</span><span class="n">slab_model</span><span class="o">.</span><span class="n">solve_all</span><span class="p">(</span><span class="n">k_vec</span><span class="p">)</span>

<span class="c1"># plotting of band structure</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plotting bandstructure...&#39;</span><span class="p">)</span>

<span class="c1"># First make a figure object</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="c1"># plot all bands</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">evals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_dist</span><span class="p">,</span><span class="n">evals</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="s2">&quot;k-&quot;</span><span class="p">)</span>
<span class="c1"># zoom in close to the zero energy</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">k_dist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">k_dist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
<span class="c1"># put title on top</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Graphene arbitrary surface band structure&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;k parallel to edge&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Band energy&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">k_node</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">((</span><span class="sa">r</span><span class="s1">&#39;$0$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\pi$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$2\pi$&#39;</span><span class="p">))</span>
<span class="c1"># make an PDF figure of a plot</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;supercell_band.pdf&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/959b0a277deb2a02c45a7a16a8609e37/supercell.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>)</p>
<figure class="align-default" id="id18">
<img alt="_images/supercell_00.png" class="plot-directive" src="_images/supercell_00.png" />
<figcaption>
<p><span class="caption-text">(<a class="reference download internal" download="" href="_downloads/6b93e99d36d8b3f8b2c72dce96a3d02b/supercell_00.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/6d364b9ac7906175fa80ad9a3f8cbd70/supercell_00.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</span><a class="headerlink" href="#id18" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id19">
<img alt="_images/supercell_01.png" class="plot-directive" src="_images/supercell_01.png" />
<figcaption>
<p><span class="caption-text">(<a class="reference download internal" download="" href="_downloads/39587e130826b3a48993156e78d8ce22/supercell_01.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/7e5a517195a1290835e854f62b03b4e0/supercell_01.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</span><a class="headerlink" href="#id19" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="buckled-layer">
<span id="id3"></span><h2>Buckled layer<a class="headerlink" href="#buckled-layer" title="Link to this heading">¶</a></h2>
<p>This is a very simple illustration of a slab geometry in which
the orbitals are specified in a 3D space, but the system is only
extensive in 2D, so that k-space is only 2D.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1"># buckled layer model on rectangular lattice</span>
<span class="c1"># illustrates usage of function k_path</span>

<span class="c1"># Copyright under GNU General Public License 2010, 2012, 2016</span>
<span class="c1"># by Sinisa Coh and David Vanderbilt (see gpl-pythtb.txt)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pythtb</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span> <span class="c1"># import TB model class</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># real space is 3D</span>
<span class="c1"># define lattice vectors</span>
<span class="n">lat</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.25</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">3.0</span><span class="p">]]</span>
<span class="c1"># define coordinates of orbitals</span>
<span class="n">orb</span><span class="o">=</span><span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">0.15</span><span class="p">],[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.15</span><span class="p">]]</span>

<span class="c1"># only first two lattice vectors repeat, so k-space is 2D</span>
<span class="n">my_model</span><span class="o">=</span><span class="n">tb_model</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">orb</span><span class="p">)</span>

<span class="c1"># set model parameters</span>
<span class="n">delta</span><span class="o">=</span><span class="mf">1.1</span>
<span class="n">t</span><span class="o">=</span><span class="mf">0.6</span>

<span class="c1"># set on-site energies</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_onsite</span><span class="p">([</span><span class="o">-</span><span class="n">delta</span><span class="p">,</span><span class="n">delta</span><span class="p">])</span>
<span class="c1"># set hoppings (one for each connected pair of orbitals)</span>
<span class="c1"># (amplitude, i, j, [lattice vector to cell containing j])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

<span class="c1"># print tight-binding model</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>

<span class="c1"># ----------------------------------------</span>
<span class="c1"># specify k-space path</span>
<span class="c1"># ----------------------------------------</span>

<span class="c1"># specify a path in k-space by listing a set of nodes; the path</span>
<span class="c1"># will consist of straight line segments connecting these nodes</span>
<span class="n">path</span><span class="o">=</span><span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">],[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">],[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]]</span>

<span class="c1"># specify labels for these nodal points</span>
<span class="n">label</span><span class="o">=</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Gamma $&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$X$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$M$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\Gamma $&#39;</span><span class="p">)</span>

<span class="c1"># call function k_path to construct the actual path</span>
<span class="p">(</span><span class="n">k_vec</span><span class="p">,</span><span class="n">k_dist</span><span class="p">,</span><span class="n">k_node</span><span class="p">)</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">k_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="mi">81</span><span class="p">)</span>
<span class="c1"># inputs:</span>
<span class="c1">#   path: see above</span>
<span class="c1">#   81: number of interpolated k-points to be plotted</span>
<span class="c1"># outputs:</span>
<span class="c1">#   k_vec: list of interpolated k-points</span>
<span class="c1">#   k_dist: horizontal axis position of each k-point in the list</span>
<span class="c1">#   k_node: horizontal axis position of each original node</span>

<span class="c1"># ----------------------------------------</span>
<span class="c1"># do bandstructure calculation</span>
<span class="c1"># ----------------------------------------</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Calculating bandstructure...&#39;</span><span class="p">)</span>
<span class="n">evals</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">solve_all</span><span class="p">(</span><span class="n">k_vec</span><span class="p">)</span>

<span class="c1"># ----------------------------------------</span>
<span class="c1"># plot band structure</span>
<span class="c1"># ----------------------------------------</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plotting bandstructure...&#39;</span><span class="p">)</span>

<span class="c1"># Initialize plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Bandstructure for buckled rectangular layer&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Band energy&quot;</span><span class="p">)</span>

<span class="c1"># specify horizontal axis details</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">k_node</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">k_node</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="c1"># put tickmarks and labels at node positions</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">k_node</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
<span class="c1"># add vertical lines at node positions</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k_node</span><span class="p">)):</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">k_node</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="c1"># Plot two bands</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_dist</span><span class="p">,</span><span class="n">evals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_dist</span><span class="p">,</span><span class="n">evals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># save as PDF</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;buckled_layer.pdf&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/22d657cafa73374343c80492284afa66/buckled_layer.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/c504963fd7d9681a5a0535d3864c6d11/buckled_layer.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/4fcd60070fc91f583c5e921b75696e1a/buckled_layer.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/buckled_layer.png" class="plot-directive" src="_images/buckled_layer.png" />
</figure>
</section>
<section id="hybrid-wannier-functions-on-a-cubic-slab">
<span id="cubic-slab-hwf"></span><h2>Hybrid Wannier functions on a cubic slab<a class="headerlink" href="#hybrid-wannier-functions-on-a-cubic-slab" title="Link to this heading">¶</a></h2>
<p>This code illustrates a calculation of the Berry phases along x
of individual z-localized hybrid Wannier bands for a slab model
(finite in z but extended in x and y), using a <em>wf_array</em> structure
to simplify the calculation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_function</span> <span class="c1"># python3 style print</span>

<span class="c1"># Construct and compute Berry phases of hybrid Wannier functions</span>
<span class="c1"># for a simple slab model</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pythtb</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span> <span class="c1"># import TB model class</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># set up model on bcc motif (CsCl structure)</span>
<span class="c1"># nearest-neighbor hopping only, but of two different strengths</span>
<span class="k">def</span><span class="w"> </span><span class="nf">set_model</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span><span class="n">ta</span><span class="p">,</span><span class="n">tb</span><span class="p">):</span>
  <span class="n">lat</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]]</span>
  <span class="n">orb</span><span class="o">=</span><span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">]]</span>
  <span class="n">model</span><span class="o">=</span><span class="n">tb_model</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">orb</span><span class="p">)</span>
  <span class="n">model</span><span class="o">.</span><span class="n">set_onsite</span><span class="p">([</span><span class="o">-</span><span class="n">delta</span><span class="p">,</span><span class="n">delta</span><span class="p">])</span>
  <span class="k">for</span> <span class="n">lvec</span> <span class="ow">in</span> <span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
    <span class="n">model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">ta</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lvec</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">lvec</span> <span class="ow">in</span> <span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
    <span class="n">model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">tb</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lvec</span><span class="p">)</span>

  <span class="c1"># Symmetry is actually orthorhombic with a simple m_y mirror</span>
  <span class="c1"># and two diagonal mirror planes containing the y axis</span>

  <span class="k">return</span> <span class="n">model</span>

<span class="c1"># set model parameters and construct bulk model</span>
<span class="n">delta</span><span class="o">=</span><span class="mf">1.0</span>   <span class="c1"># site energy shift</span>
<span class="n">ta</span><span class="o">=</span><span class="mf">0.4</span>      <span class="c1"># six weaker hoppings</span>
<span class="n">tb</span><span class="o">=</span><span class="mf">0.7</span>      <span class="c1"># two stronger hoppings</span>
<span class="n">bulk_model</span><span class="o">=</span><span class="n">set_model</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span><span class="n">ta</span><span class="p">,</span><span class="n">tb</span><span class="p">)</span>

<span class="c1"># bulk_model.display()</span>

<span class="c1"># make slab model</span>
<span class="n">nl</span><span class="o">=</span><span class="mi">9</span> <span class="c1"># number of layers</span>
<span class="n">slab_model</span><span class="o">=</span><span class="n">bulk_model</span><span class="o">.</span><span class="n">cut_piece</span><span class="p">(</span><span class="n">nl</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">glue_edgs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># remove top orbital so top and bottom have the same termination</span>
<span class="n">slab_model</span><span class="o">=</span><span class="n">slab_model</span><span class="o">.</span><span class="n">remove_orb</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nl</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Constructed </span><span class="si">%2d</span><span class="s1">-layer slab model</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">nl</span><span class="p">)</span>

<span class="c1"># slab_model.display()</span>

<span class="c1"># solve on grid to check insulating</span>
<span class="n">nk</span><span class="o">=</span><span class="mi">10</span>
<span class="n">k_1d</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="n">nk</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">kpts</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">kx</span> <span class="ow">in</span> <span class="n">k_1d</span><span class="p">:</span>
  <span class="k">for</span> <span class="n">ky</span> <span class="ow">in</span> <span class="n">k_1d</span><span class="p">:</span>
    <span class="n">kpts</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">kx</span><span class="p">,</span><span class="n">ky</span><span class="p">])</span>
<span class="n">evals</span><span class="o">=</span><span class="n">slab_model</span><span class="o">.</span><span class="n">solve_all</span><span class="p">(</span><span class="n">kpts</span><span class="p">)</span>
<span class="c1"># delta &gt; 0, so there are nl valence and nl-1 conduction bands</span>
<span class="n">e_vb</span><span class="o">=</span><span class="n">evals</span><span class="p">[:</span><span class="n">nl</span><span class="p">,:]</span>
<span class="n">e_cb</span><span class="o">=</span><span class="n">evals</span><span class="p">[</span><span class="n">nl</span><span class="o">+</span><span class="mi">1</span><span class="p">:,:]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;VB min,max = </span><span class="si">%6.3f</span><span class="s2"> , </span><span class="si">%6.3f</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">e_vb</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">e_vb</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CB min,max = </span><span class="si">%6.3f</span><span class="s2"> , </span><span class="si">%6.3f</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">e_cb</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">e_cb</span><span class="p">)))</span>

<span class="c1"># initialize and fill wf_array object for Bloch functions</span>
<span class="n">nk</span><span class="o">=</span><span class="mi">9</span>
<span class="n">bloch_arr</span><span class="o">=</span><span class="n">wf_array</span><span class="p">(</span><span class="n">slab_model</span><span class="p">,[</span><span class="n">nk</span><span class="p">,</span><span class="n">nk</span><span class="p">])</span>
<span class="n">bloch_arr</span><span class="o">.</span><span class="n">solve_on_grid</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
<span class="c1">#</span>
<span class="c1"># initalize wf_array to hold HWFs, and Numpy array for HWFCs</span>
<span class="n">hwf_arr</span><span class="o">=</span><span class="n">bloch_arr</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">nsta_arr</span><span class="o">=</span><span class="n">nl</span><span class="p">)</span>
<span class="n">hwfc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">nk</span><span class="p">,</span><span class="n">nk</span><span class="p">,</span><span class="n">nl</span><span class="p">])</span>

<span class="c1"># loop over k points and fill arrays with HW centers and vectors</span>
<span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nk</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nk</span><span class="p">):</span>
    <span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="n">vec</span><span class="p">)</span><span class="o">=</span><span class="n">bloch_arr</span><span class="o">.</span><span class="n">position_hwf</span><span class="p">([</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">],</span><span class="n">occ</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">nl</span><span class="p">)),</span>
        <span class="nb">dir</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">hwf_evec</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">basis</span><span class="o">=</span><span class="s2">&quot;orbital&quot;</span><span class="p">)</span>
    <span class="n">hwfc</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]</span><span class="o">=</span><span class="n">val</span>
    <span class="n">hwf_arr</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]</span><span class="o">=</span><span class="n">vec</span>
<span class="c1"># impose periodic boundary conditions</span>
<span class="n">hwf_arr</span><span class="o">.</span><span class="n">impose_pbc</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">hwf_arr</span><span class="o">.</span><span class="n">impose_pbc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># compute and print mean and standard deviation of Wannier centers by layer</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Locations of hybrid Wannier centers along z:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Layer      &#39;</span><span class="o">+</span><span class="n">nl</span><span class="o">*</span><span class="s1">&#39;  </span><span class="si">%2d</span><span class="s1">    &#39;</span><span class="o">%</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">nl</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Mean   &#39;</span><span class="o">+</span><span class="n">nl</span><span class="o">*</span><span class="s1">&#39;</span><span class="si">%8.4f</span><span class="s1">&#39;</span><span class="o">%</span><span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">hwfc</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Std Dev&#39;</span><span class="o">+</span><span class="n">nl</span><span class="o">*</span><span class="s1">&#39;</span><span class="si">%8.4f</span><span class="s1">&#39;</span><span class="o">%</span><span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">hwfc</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))))</span>

<span class="c1"># compute and print layer contributions to polarization along x, then y</span>
<span class="n">px</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nl</span><span class="p">,</span><span class="n">nk</span><span class="p">))</span>
<span class="n">py</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nl</span><span class="p">,</span><span class="n">nk</span><span class="p">))</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nl</span><span class="p">):</span>
  <span class="n">px</span><span class="p">[</span><span class="n">n</span><span class="p">,:]</span><span class="o">=</span><span class="n">hwf_arr</span><span class="o">.</span><span class="n">berry_phase</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">occ</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Berry phases along x (rows correspond to k_y points):</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Layer      &#39;</span><span class="o">+</span><span class="n">nl</span><span class="o">*</span><span class="s1">&#39;  </span><span class="si">%2d</span><span class="s1">    &#39;</span><span class="o">%</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">nl</span><span class="p">)))</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nk</span><span class="p">):</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;         &#39;</span><span class="o">+</span><span class="n">nl</span><span class="o">*</span><span class="s1">&#39;</span><span class="si">%8.4f</span><span class="s1">&#39;</span><span class="o">%</span><span class="nb">tuple</span><span class="p">(</span><span class="n">px</span><span class="p">[:,</span><span class="n">k</span><span class="p">]))</span>
<span class="c1"># when averaging, don&#39;t count last k-point</span>
<span class="n">px_mean</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">px</span><span class="p">[:,:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">  Ave    &#39;</span><span class="o">+</span><span class="n">nl</span><span class="o">*</span><span class="s1">&#39;</span><span class="si">%8.4f</span><span class="s1">&#39;</span><span class="o">%</span><span class="nb">tuple</span><span class="p">(</span><span class="n">px_mean</span><span class="p">))</span>

<span class="c1"># Similar calculations along y give zero due to m_y mirror&#39;)</span>

<span class="n">nlh</span><span class="o">=</span><span class="n">nl</span><span class="o">//</span><span class="mi">2</span>
<span class="n">sum_top</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">px_mean</span><span class="p">[:</span><span class="n">nlh</span><span class="p">])</span>
<span class="n">sum_bot</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">px_mean</span><span class="p">[</span><span class="o">-</span><span class="n">nlh</span><span class="p">:])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">  Surface sums: Top, Bottom = </span><span class="si">%8.4f</span><span class="s1"> , </span><span class="si">%8.4f</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">sum_top</span><span class="p">,</span><span class="n">sum_bot</span><span class="p">))</span>

<span class="c1"># These quantities are essentially the &quot;surface polarizations&quot; of the</span>
<span class="c1"># model as defined within the hybrid Wannier gauge.  See, e.g.,</span>
<span class="c1"># S. Ren, I. Souza, and D. Vanderbilt, &quot;Quadrupole moments, edge</span>
<span class="c1"># polarizations, and corner charges in the Wannier representation,&quot;</span>
<span class="c1"># Phys. Rev. B 103, 035147 (2021).</span>

<span class="c1"># Make bar chart</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">nl</span><span class="p">),</span><span class="n">px_mean</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">nl</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Layer index of hybrid Wannier band&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Contribution to $P_x$&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;cubic_slab_hwf.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/9b57d1b84bdf7704a795ce0ad8d7e6fc/cubic_slab_hwf.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/aaf26cb3ded9f3452c6de2459975ff83/cubic_slab_hwf.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/4c7d22e2678618ddd558fc8163cb579c/cubic_slab_hwf.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/cubic_slab_hwf.png" class="plot-directive" src="_images/cubic_slab_hwf.png" />
</figure>
</section>
<section id="bn-ribbon-with-change-of-nonperiodic-vector">
<span id="bn-ribbon-berry"></span><h2>BN ribbon with change of nonperiodic vector<a class="headerlink" href="#bn-ribbon-with-change-of-nonperiodic-vector" title="Link to this heading">¶</a></h2>
<p>This boron nitride ribbon calculation illustrates a case where
it is a good idea to change a nonperiodic lattice vector to be
normal to the periodic direction(s).  While the model is
physically the same before and after the change, as shown by the
identical band structures, the Berry phase is consistent with
the polarization in the extended direction only after the change.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1"># Boron nitride ribbon: Compute Berry phase</span>

<span class="c1"># Copyright under GNU General Public License 2010, 2012, 2016, 2021</span>
<span class="c1"># by Sinisa Coh and David Vanderbilt (see gpl-pythtb.txt)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pythtb</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span> <span class="c1"># import TB model class</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># define lattice vectors</span>
<span class="n">lat</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.5</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">]]</span>
<span class="c1"># define coordinates of orbitals</span>
<span class="n">orb</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">],[</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">]]</span>

<span class="c1"># ------</span>

<span class="c1"># make two dimensional tight-binding boron nitride model</span>
<span class="n">my_model</span><span class="o">=</span><span class="n">tb_model</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">orb</span><span class="p">)</span>

<span class="c1"># set periodic model</span>
<span class="n">delta</span><span class="o">=</span><span class="mf">0.4</span>
<span class="n">t</span><span class="o">=-</span><span class="mf">1.0</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_onsite</span><span class="p">([</span><span class="o">-</span><span class="n">delta</span><span class="p">,</span><span class="n">delta</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">set_hop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="c1"># cut out 3 unit cells along second direction with open boundary</span>
<span class="c1">#   conditions to make ribbon model</span>
<span class="n">model_orig</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">cut_piece</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">glue_edgs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">========================================================&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;construct and display original model with tilted&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;nonperiodic lattice vector&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;========================================================</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">model_orig</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>

<span class="c1"># ------</span>

<span class="c1"># reset second lattice vector normal to the first one</span>
<span class="c1"># model_perp=model_orig.change_nonperiodic_vector(1,to_home_suppress_warning=True)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">========================================================&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;construct and display new model with nonperiodic lattice&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;vector changed to be normal to the periodic direction&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;========================================================</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">model_perp</span><span class="o">=</span><span class="n">model_orig</span><span class="o">.</span><span class="n">change_nonperiodic_vector</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">model_perp</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>

<span class="c1"># ------</span>

<span class="c1"># initialize figure with subplots</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span><span class="mf">2.8</span><span class="p">))</span>

<span class="c1"># ------------------------------------------------------------------</span>
<span class="c1"># function to print model, plot band structure, and compute Berry phase</span>
<span class="k">def</span><span class="w"> </span><span class="nf">run_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">panel</span><span class="p">):</span>
  <span class="n">numk</span><span class="o">=</span><span class="mi">41</span>
  <span class="p">(</span><span class="n">k_vec</span><span class="p">,</span><span class="n">k_dist</span><span class="p">,</span><span class="n">k_node</span><span class="p">)</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">k_path</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">],[</span><span class="mf">0.5</span><span class="p">]],</span><span class="n">numk</span><span class="p">,</span><span class="n">report</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">eval</span><span class="p">,</span><span class="n">evec</span><span class="p">)</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">solve_all</span><span class="p">(</span><span class="n">k_vec</span><span class="p">,</span><span class="n">eig_vectors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="c1">#</span>
  <span class="c1"># plot band structure</span>
  <span class="n">ax</span><span class="p">[</span><span class="n">panel</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Band structure - &quot;</span><span class="o">+</span><span class="p">[</span><span class="s2">&quot;original&quot;</span><span class="p">,</span><span class="s2">&quot;modified&quot;</span><span class="p">][</span><span class="n">panel</span><span class="p">])</span>
  <span class="n">ax</span><span class="p">[</span><span class="n">panel</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Reduced wavevector&quot;</span><span class="p">)</span>
  <span class="n">ax</span><span class="p">[</span><span class="n">panel</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Band energy&quot;</span><span class="p">)</span>
  <span class="n">ax</span><span class="p">[</span><span class="n">panel</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span>
  <span class="n">n_bands</span><span class="o">=</span><span class="nb">eval</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_bands</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">panel</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_vec</span><span class="p">,</span><span class="nb">eval</span><span class="p">[</span><span class="n">band</span><span class="p">,:],</span><span class="s2">&quot;k-&quot;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
  <span class="c1">#</span>
  <span class="c1"># compute and print Berry phase at half filling</span>
  <span class="n">wf</span><span class="o">=</span><span class="n">wf_array</span><span class="p">(</span><span class="n">model</span><span class="p">,[</span><span class="n">numk</span><span class="p">])</span>
  <span class="n">wf</span><span class="o">.</span><span class="n">solve_on_grid</span><span class="p">([</span><span class="mf">0.</span><span class="p">])</span>
  <span class="n">n_occ</span><span class="o">=</span><span class="n">n_bands</span><span class="o">//</span><span class="mi">2</span>
  <span class="n">berry_phase</span><span class="o">=</span><span class="n">wf</span><span class="o">.</span><span class="n">berry_phase</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_occ</span><span class="p">),</span><span class="nb">dir</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Berry phase = </span><span class="si">%10.7f</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">berry_phase</span><span class="p">,))</span>
  <span class="k">return</span><span class="p">()</span>
<span class="c1"># ------------------------------------------------------------------</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">========================================================&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;solve both models, showing that the band structures are&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;the same, but Berry phases are different&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;========================================================</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Original model</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">run_model</span><span class="p">(</span><span class="n">model_orig</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Revised model</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">run_model</span><span class="p">(</span><span class="n">model_perp</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># save figure</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;bn_ribbon_berry.pdf&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Band structures have been saved to &quot;bn_ribbon_berry.pdf&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># Notes</span>
<span class="c1">#</span>
<span class="c1"># Let x be along the extended direction and y be normal to it.</span>
<span class="c1">#</span>
<span class="c1"># This model has an M_x mirror symmetry, so the Berry phase is</span>
<span class="c1"># expected to be 0 or pi.  We find it to be zero, but only after the</span>
<span class="c1"># &#39;change_nonperiodic_vector&#39; method is used to force the nonperiodic</span>
<span class="c1"># &quot;lattice vector&quot; to be perpedicular to the extended direction.</span>
<span class="c1"># </span>
<span class="c1"># The physical meaning of the Berry phase in the original model</span>
<span class="c1"># calculation is rather subtle.  It is related to the position of</span>
<span class="c1"># the joint Wannier center (i.e., summed over occupied bands) in</span>
<span class="c1"># the direction of reciprocal lattice vector 0, which has a</span>
<span class="c1"># y component as well as an x component (since it must be normal</span>
<span class="c1"># to real space lattice vector 1).  The joint Wannier center gets</span>
<span class="c1"># displaced along y as the hopping &#39;t&#39; is changed, so the Berry</span>
<span class="c1"># phase calculation gets &quot;contaminated&quot; by this displacement.</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/27c37bc4850f4efe8a44ca80dda5d17d/bn_ribbon_berry.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/2e329db56cfc8d61ccd5c6e01dfd41cd/bn_ribbon_berry.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/ba17c272ee09a60dea84a206dbb5fc02/bn_ribbon_berry.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/bn_ribbon_berry.png" class="plot-directive" src="_images/bn_ribbon_berry.png" />
</figure>
</section>
<section id="quick-wannier90-example">
<span id="w90-quick"></span><h2>Quick Wannier90 example<a class="headerlink" href="#quick-wannier90-example" title="Link to this heading">¶</a></h2>
<p>To run the interface with Wannier90, you must first download the
following <a class="reference download internal" download="" href="_downloads/6736bace7dc882b319959de08e71a1fe/wannier90_example.tar.gz"><code class="xref download docutils literal notranslate"><span class="pre">wannier90</span> <span class="pre">output</span> <span class="pre">example</span></code></a> and unpack it with the following
command in unix command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tar</span> <span class="o">-</span><span class="n">zxf</span> <span class="n">wannier90_example</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
</pre></div>
</div>
<p>The example below will read the tight-binding model from the Wannier90
calculation, create a simplified model in which some small hopping
terms are ignored, and finally plot the interpolated band structure.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1"># Copyright under GNU General Public License 2010, 2012, 2016</span>
<span class="c1"># by Sinisa Coh and David Vanderbilt (see gpl-pythtb.txt)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pythtb</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span> <span class="c1"># import TB model class</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># read output from Wannier90 that should be in folder named &quot;example_a&quot;</span>
<span class="c1">#   see instructions above for how to obtain the example output from </span>
<span class="c1">#   Wannier90 for testing purposes</span>
<span class="n">silicon</span><span class="o">=</span><span class="n">w90</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;silicon_w90&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;silicon&quot;</span><span class="p">)</span>

<span class="c1"># get tight-binding model without hopping terms above 0.01 eV</span>
<span class="n">my_model</span><span class="o">=</span><span class="n">silicon</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">min_hopping_norm</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>

<span class="c1"># solve model on a path and plot it</span>
<span class="n">path</span><span class="o">=</span><span class="p">[[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">],[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.375</span><span class="p">,</span><span class="o">-</span><span class="mf">0.375</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]]</span>
<span class="c1"># labels of the nodes</span>
<span class="n">k_label</span><span class="o">=</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$L$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\Gamma$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$X$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$K$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\Gamma$&#39;</span><span class="p">)</span>
<span class="c1"># call function k_path to construct the actual path</span>
<span class="p">(</span><span class="n">k_vec</span><span class="p">,</span><span class="n">k_dist</span><span class="p">,</span><span class="n">k_node</span><span class="p">)</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">k_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="mi">101</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">evals</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">solve_all</span><span class="p">(</span><span class="n">k_vec</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">evals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_dist</span><span class="p">,</span><span class="n">evals</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="s2">&quot;k-&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k_node</span><span class="p">)):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">k_node</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Path in k-space&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Band energy (eV)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">k_dist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">k_dist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">k_node</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">k_label</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;silicon_quick.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/c15547e81852ebf11e1be0651529e57a/w90_quick.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>)</p>
</section>
<section id="longer-wannier90-example">
<span id="w90-long"></span><h2>Longer Wannier90 example<a class="headerlink" href="#longer-wannier90-example" title="Link to this heading">¶</a></h2>
<p>This is a somewhat longer example showing how to use the interface to
Wannier90.  Unlike the example above, this one includes some
diagnostics as well.</p>
<p>To run the interface with Wannier90, first download
<a class="reference download internal" download="" href="_downloads/6736bace7dc882b319959de08e71a1fe/wannier90_example.tar.gz"><code class="xref download docutils literal notranslate"><span class="pre">wannier90</span> <span class="pre">output</span> <span class="pre">example</span></code></a>
and unpack it with the following command in unix command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tar</span> <span class="o">-</span><span class="n">zxf</span> <span class="n">wannier90_example</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
</pre></div>
</div>
<p>Here is the source code of the example.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1"># Copyright under GNU General Public License 2010, 2012, 2016</span>
<span class="c1"># by Sinisa Coh and David Vanderbilt (see gpl-pythtb.txt)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pythtb</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span> <span class="c1"># import TB model class</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># read output from Wannier90 that should be in folder named &quot;example_a&quot;</span>
<span class="c1"># see instructions above for how to obtain the example output from Wannier90</span>
<span class="c1"># for testing purposes</span>
<span class="n">silicon</span><span class="o">=</span><span class="n">w90</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;silicon_w90&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;silicon&quot;</span><span class="p">)</span>

<span class="c1"># hard coded fermi level in eV</span>
<span class="n">fermi_ev</span><span class="o">=</span><span class="mf">0.62285135E+01</span>

<span class="c1"># all pair distances berween the orbitals</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Shells:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">silicon</span><span class="o">.</span><span class="n">shells</span><span class="p">())</span>

<span class="c1"># plot hopping terms as a function of distance on a log scale</span>
<span class="p">(</span><span class="n">dist</span><span class="p">,</span><span class="n">ham</span><span class="p">)</span><span class="o">=</span><span class="n">silicon</span><span class="o">.</span><span class="n">dist_hop</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ham</span><span class="p">)))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Distance (A)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\log H$ (eV)&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;silicon_dist_ham.pdf&quot;</span><span class="p">)</span>

<span class="c1"># get tb model in which some small terms are ignored</span>
<span class="n">my_model</span><span class="o">=</span><span class="n">silicon</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">zero_energy</span><span class="o">=</span><span class="n">fermi_ev</span><span class="p">,</span><span class="n">min_hopping_norm</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">max_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ignorable_imaginary_part</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>

<span class="c1"># in the case that all steps up to now take a lot of computer time</span>
<span class="c1"># it is advised to save tb model to disk with cPickle module:</span>
<span class="c1">#   import cPickle</span>
<span class="c1">#   cPickle.dump(my_model,open(&quot;store.pkl&quot;,&quot;wb&quot;))</span>
<span class="c1"># Later one can load in the model from disk in a separate script with</span>
<span class="c1">#   my_model=cPickle.load(open(&quot;store.pkl&quot;,&quot;rb&quot;))</span>

<span class="c1"># solve and plot on the same path as used in wannier90</span>
<span class="c1"># small discrepancy in the plot is there because of the terms that</span>
<span class="c1"># were ignore in the silicon.model function call above</span>
<span class="c1">#</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="p">(</span><span class="n">w90_kpt</span><span class="p">,</span><span class="n">w90_evals</span><span class="p">)</span><span class="o">=</span><span class="n">silicon</span><span class="o">.</span><span class="n">w90_bands_consistency</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">w90_evals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">w90_evals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span><span class="n">w90_evals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">fermi_ev</span><span class="p">,</span><span class="s2">&quot;k-&quot;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=-</span><span class="mi">100</span><span class="p">)</span>
<span class="c1"># now interpolate from the model on the same path in k-space </span>
<span class="n">int_evals</span><span class="o">=</span><span class="n">my_model</span><span class="o">.</span><span class="n">solve_all</span><span class="p">(</span><span class="n">w90_kpt</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">int_evals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">int_evals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span><span class="n">int_evals</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="s2">&quot;r-&quot;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=-</span><span class="mi">50</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">int_evals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;K-path from Wannier90&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Band energy (eV)&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;silicon.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/7d93385239bf7aa753914d1ee2c317ca/w90.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>)</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h3><a href="index.html">PythTB</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="formalism.html">Formalism</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="citation.html">Citation</a></li>
</ul>

  <h3><a href="index.html">This page</a></h3>
  <ul>
<li><a class="reference internal" href="#">Examples</a><ul>
<li><a class="reference internal" href="#id1">Simple example</a></li>
<li><a class="reference internal" href="#checkerboard-model">Checkerboard model</a></li>
<li><a class="reference internal" href="#trestle">Trestle</a></li>
<li><a class="reference internal" href="#molecule">Molecule</a></li>
<li><a class="reference internal" href="#graphene-model">Graphene model</a></li>
<li><a class="reference internal" href="#berry-phase-around-dirac-cone-in-graphene">Berry phase around Dirac cone in graphene</a></li>
<li><a class="reference internal" href="#one-dimensional-cycle-of-1d-tight-binding-model">One-dimensional cycle of 1D tight-binding model</a></li>
<li><a class="reference internal" href="#one-dimensional-cycle-on-a-finite-1d-chain">One-dimensional cycle on a finite 1D chain</a></li>
<li><a class="reference internal" href="#haldane-model">Haldane model</a></li>
<li><a class="reference internal" href="#finite-haldane-model">Finite Haldane model</a></li>
<li><a class="reference internal" href="#edge-states">Edge states</a></li>
<li><a class="reference internal" href="#berry-phases-in-haldane-model">Berry phases in Haldane model</a></li>
<li><a class="reference internal" href="#hybrid-wannier-centers-in-haldane-model">Hybrid Wannier centers in Haldane model</a></li>
<li><a class="reference internal" href="#kane-mele-model-using-spinor-features">Kane-Mele model using spinor features</a></li>
<li><a class="reference internal" href="#visualization-example">Visualization example</a></li>
<li><a class="reference internal" href="#arbitrary-graphene-surface">Arbitrary graphene surface</a></li>
<li><a class="reference internal" href="#buckled-layer">Buckled layer</a></li>
<li><a class="reference internal" href="#hybrid-wannier-functions-on-a-cubic-slab">Hybrid Wannier functions on a cubic slab</a></li>
<li><a class="reference internal" href="#bn-ribbon-with-change-of-nonperiodic-vector">BN ribbon with change of nonperiodic vector</a></li>
<li><a class="reference internal" href="#quick-wannier90-example">Quick Wannier90 example</a></li>
<li><a class="reference internal" href="#longer-wannier90-example">Longer Wannier90 example</a></li>
</ul>
</li>
</ul>

<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="formalism.html" title="Formalism"
             >next</a> |</li>
        <li class="right" >
          <a href="install.html" title="Installation"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">PythTB 1.8.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Examples</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2016, Sinisa Coh and David Vanderbilt.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    </div>
  </body>
</html>